[
  {
    "objectID": "index.html",
    "href": "index.html",
    "title": "Mendelian Randomization Tutorial",
    "section": "",
    "text": "Preface\nMendelian randomization (MR) is a method used to infer causality between and exposure and outcome using genetic variants as instrumental variables. It is based on the idea that genetic variants, which are inherited randomly and not influenced by environmental factors or reverse causation, can be used to estimate the causal effect of an exposure on an outcome.\nThese resources aim to provide a starting point for understanding the basic concepts and methods of MR, as well as the current best practices and software tools available for conducting MR studies."
  },
  {
    "objectID": "scripts/intro.html#sugested-readings",
    "href": "scripts/intro.html#sugested-readings",
    "title": "Introduction",
    "section": "Sugested Readings",
    "text": "Sugested Readings\nThese resources provide a good starting point for understanding the basic concepts and methods of MR, as well as the current best practices and software tools available for conducting MR studies.\n\nGenome-wide association studies\n\nUffelmann, E. et al. Genome-wide association studies. Nat Rev Methods Primers 1, 59 (2021).\nMarees, A. T. et al. A tutorial on conducting genome‐wide association studies: Quality control and statistical analysis. Int J Method Psych 27, e1608 (2018).\nMacArthur, J. A. L. et al. Workshop proceedings: GWAS summary statistics standards and sharing. Cell Genom 1, 100004 (2021).\n\n\n\nMendelian Randomization\n\nSanderson, E. et al. Mendelian randomization. Nat Rev Methods Primers 2, 6 (2022).\nDavies, N. M., Holmes, M. V. & Smith, G. D. Reading Mendelian randomisation studies: a guide, glossary, and checklist for clinicians. Bmj 362, k601 (2017).\nHemani, G. et al. The MR-Base platform supports systematic causal inference across the human phenome. Elife 7, e34408 (2018).\nSkrivankova, V. W. et al. Strengthening the Reporting of Observational Studies in Epidemiology Using Mendelian Randomization. Jama 326, 1614–1621 (2021).\nSkrivankova, V. W. et al. Strengthening the reporting of observational studies in epidemiology using mendelian randomisation (STROBE-MR): explanation and elaboration. Bmj 375, n2233 (2021).\n\n\n\nMultivariable Mendelian Randomization\n\nSanderson, E. Multivariable Mendelian Randomization and Mediation. Csh Perspect Med 11, a038984 (2020).\nCarter, A. R. et al. Mendelian randomisation for mediation analysis: current methods and challenges for implementation. Eur J Epidemiol 36, 465–478 (2021).\n\n\n\nR packages, tutorials, and databases\n\nGWAS Catalog: A database of genome-wide association studies and loci-trait associsation discovered.\nPhenoScanner: A database of human genotype-phenotype associations.\nMungeSumstats: Tutorial for standardizing GWAS summary statistics using the MungeSumstats R package.\nTwoSampleMR: Tutorial for conducting Two-Sample Mendelian randomization using the TwoSampleMR R package\nMVMR: Tutorial for conducting multivariable Mendelian ranomization using the MVMR R package.\nMendelianRandomization: Vignette for the MendelianRandomization R package.\n\nMR Dictionary: The definitive list of terms for Mendelian randomization research"
  },
  {
    "objectID": "scripts/phenotypes.html#lipids",
    "href": "scripts/phenotypes.html#lipids",
    "title": "1  Phenotypes",
    "section": "Lipids",
    "text": "Lipids\nA GWAS of low-density lipoprotein (LDL) cholesterol, high-density lipoprotein (HDL) cholesterol, triglycerides and total cholesterol levels conducted in 188,577 individuals that identified 157 loci were associated with lipid levels.\nWiller, C. J. et al. Discovery and refinement of loci associated with lipid levels. Nat Genet 45, 1274–83 (2013).\nSummary statistics\n\nLDL Cholesterol\nHDL Cholesterol\nTriglycerides\nTotal cholesterol\n\n\n\nTotal Cholesterol Manhattan\ntc_path = \"resources/Willer2013tc.chrall.CPRA_b37.tsv.gz\"\ntc_ss &lt;- read_tsv(tc_path, comment = \"##\", col_types = coltypes, \n                        col_select = c(DBSNP_ID, CHROM, POS, REF, ALT, AF, BETA, SE, Z, P, N, TRAIT))\n\n# Filter on p &lt; 0.5 to reduce compute\nggman(filter(tc_ss, P &lt; 0.05 & P &gt; 1e-100), snp = \"DBSNP_ID\", bp = \"POS\", chrom = \"CHROM\", pvalue = \"P\", relative.positions = TRUE) + \n  theme_classic()"
  },
  {
    "objectID": "scripts/phenotypes.html#alzheimers-disease",
    "href": "scripts/phenotypes.html#alzheimers-disease",
    "title": "1  Phenotypes",
    "section": "Alzheimer’s disease",
    "text": "Alzheimer’s disease\nA GWAS of Alzheimer’s disease conducted in 94,437 indivudles by the International Genomics Alzheiemr’s Project that Identified 20 genome-wide signiﬁcant loci.\nKunkle, B. W. et al. Genetic meta-analysis of diagnosed Alzheimer’s disease identifies new risk loci and implicates Aβ, tau, immunity and lipid processing. Nat Genet 51, 414–430 (2019).\nSummary statistics\n\nLate-onset Alzheimer’s disease\n\n\n\nAD Manhattan Plot\nAD_path = \"resources/Kunkle2019load_stage123.chrall.CPRA_b37.tsv.gz\"\nAD_ss &lt;- read_tsv(AD_path, comment = \"##\",  col_types = coltypes, \n                       col_select = c(DBSNP_ID, CHROM, POS, REF, ALT, AF, BETA, SE, Z, P, N, TRAIT))\n\n# Filter on p &lt; 0.5 to reduce compute\nggman(filter(AD_ss, P &lt; 0.05 & P &gt; 1e-100), snp = \"DBSNP_ID\", bp = \"POS\", chrom = \"CHROM\", pvalue = \"P\", relative.positions = TRUE) + \n  theme_classic()"
  },
  {
    "objectID": "scripts/phenotypes.html#sumstat-standardization",
    "href": "scripts/phenotypes.html#sumstat-standardization",
    "title": "1  Phenotypes",
    "section": "SumStat Standardization",
    "text": "SumStat Standardization\nGWAS summary statistics were standardized using a Snakemake Workflow that (1) aligns effect alleles to the alternate allele on the forward strand of the human genome reference build and normalizes indels, (2) annotates variants with marker names using chromosome:position:ref:alt, 1000 Genomes rsIDs (phase III), and database-single-nucleotide polymorphism (dbSNP) rsIDs (b151) (3) where allele frequencies are missing, annotates allele frequencies using non-Finnish Europeans from gnomAD (version 2.1), and (4) convert summary statistics to VCF and TSV ﬁles.\nAndrews, S. J. et al. Causal Associations Between Modifiable Risk Factors and the Alzheimer’s Phenome. Ann Neurol 89, 54–65 (2021)."
  },
  {
    "objectID": "scripts/sumstats.html",
    "href": "scripts/sumstats.html",
    "title": "2  Standardizing and harmonizing GWAS SumStats",
    "section": "",
    "text": "Two-sample MR methods require the use of summary statistics from genome-wide association studies, including single nucleotide polymorphisms (SNPs), beta coefficients, standard errors, p-values, and allele frequencies. However, the historical lack of standards for data content and file formats in GWAS summary statistics has resulted in heterogeneous data sets. To address this issue, standardizing and harmonizing the GWAS summary statistics is crucial before conducting MR analyses. The GWAS Catalog and OpenGWAS platforms have developed formats such as GWAS-SSF (Hayhurst et al. 2022) and GWAS-VCF (Lyon et al. 2021) to facilitate sharing of GWAS SumStats. Tools like MungeSumstats (Murphy et al 2021) and GWAS2VCF (Lyon et al. 2021) are available that provide rapid standardization and quality control of GWAS SumStats."
  },
  {
    "objectID": "scripts/methods.html",
    "href": "scripts/methods.html",
    "title": "Methods",
    "section": "",
    "text": "An overview of different Mendelian randomization methods for evaluating the causal effect of an exposure on an outcome."
  },
  {
    "objectID": "scripts/mr_harmonization.html#exposure-dataset",
    "href": "scripts/mr_harmonization.html#exposure-dataset",
    "title": "3  Harmonizing SumStats",
    "section": "Exposure dataset",
    "text": "Exposure dataset\nThe exposure GWAS SumStats have previously been standardized to common format, however, they need to be converted to the format required by TwoSampleMR.\n\n\nImport exposure GWAS SumStats\nexposure_path = \"resources/Willer2013tc.chrall.CPRA_b37.tsv.gz\"\nexposure_ss &lt;- read_tsv(exposure_path, comment = \"##\", col_types = coltypes, \n                        col_select = c(DBSNP_ID, CHROM, POS, REF, ALT, AF, BETA, SE, Z, P, N, TRAIT))\n\n# Format data to TwoSampleMR format\nexposure &lt;- exposure_ss %&gt;%\n  format_data(.,\n    type = \"exposure\",\n    snps = NULL,\n    header = TRUE,\n    phenotype_col = \"TRAIT\",\n    snp_col = \"DBSNP_ID\",\n    beta_col = \"BETA\",\n    se_col = \"SE\",\n    eaf_col = \"AF\",\n    effect_allele_col = \"ALT\",\n    other_allele_col = \"REF\",\n    pval_col = \"P\",\n    samplesize_col = \"N\",\n    z_col = \"Z\",\n    chr_col = \"CHROM\",\n    pos_col = \"POS\",\n    log_pval = FALSE\n) %&gt;%\n  as_tibble()\n\n\nTwo-Sample MR methods usually utilize only independent genome-wide significant SNPs. The process of extracting these SNPs from the full genome-wide association study (GWAS) summary statistics involves linkage disequilibrium (LD) clumping. TwoSampleMR provides a clumping function, TwoSampleMR::clump_data(), which performs a stringent clumping procedure with a default window size of 10Mb and an r2 threshold of 0.001. Setting clump_p1 = 1 and clump_p2 = 1 will perform clumping on all available SNPs. The GWAS summary statistics used in this analysis are from a population of European ancestry, and therefore the EUR reference panel is specified.\n\n\nLD clump exposure\n# Perform LD clumping on SNP data, filter SNPs to make it run faster\nexposure_clump &lt;- exposure %&gt;% \n  filter(pval.exposure &lt; 0.01) %&gt;%\n  clump_data(.,\n  clump_kb = 10000,\n  clump_r2 = 0.001,\n  clump_p1 = 1,\n  clump_p2 = 1,\n  pop = \"EUR\"\n)\n\n# Should filter here at GWS, I dont here to demonstrate proxy snps\n# exposure_dat &lt;- filter(exposure_clump, pval.exposure &lt; 5e-8)\nexposure_dat &lt;- exposure_clump\n\n\n\n\n\n\n\n\nNote\n\n\n\nTypically, in a Two-Sample MR analysis, one would only consider genome-wide significant SNPs (SNPs with pval.exposure &lt; 5e-8). However, in this demonstration, all independent SNPs with pval.exposure &lt; 0.01 are retained to showcase how to identify proxy variants, as all of the genome-wide significant SNPs are also present in the outcome GWAS."
  },
  {
    "objectID": "scripts/mr_harmonization.html#outcome-datasets",
    "href": "scripts/mr_harmonization.html#outcome-datasets",
    "title": "3  Harmonizing SumStats",
    "section": "Outcome datasets",
    "text": "Outcome datasets\nSimilarly, the outcome dataset needs to be converted to the TwoSampleMR format.\n\n\nImport outcome GWAS SumStats\noutcome_path = \"resources/Kunkle2019load_stage123.chrall.CPRA_b37.tsv.gz\"\noutcome_ss &lt;- read_tsv(outcome_path, comment = \"##\",  col_types = coltypes, \n                       col_select = c(DBSNP_ID, CHROM, POS, REF, ALT, AF, BETA, SE, Z, P, N, TRAIT))\n\n# Format outcome\noutcome &lt;- outcome_ss %&gt;%\n  format_data(.,\n    type = \"outcome\",\n    snps = NULL,\n    header = TRUE,\n    phenotype_col = \"TRAIT\",\n    snp_col = \"DBSNP_ID\",\n    beta_col = \"BETA\",\n    se_col = \"SE\",\n    eaf_col = \"AF\",\n    effect_allele_col = \"ALT\",\n    other_allele_col = \"REF\",\n    pval_col = \"P\",\n    samplesize_col = \"N\",\n    z_col = \"Z\",\n    chr_col = \"CHROM\",\n    pos_col = \"POS\",\n    log_pval = FALSE\n) %&gt;%\n  as_tibble()\n\n\n\nLD Proxy SNPs\nProxy variants are genetic markers that are in strong linkage disequilibrium (LD) with the variants of interest, and can be used as a proxy to estimate the effect of the variants of interest on the outcome of interest. In some cases, variants in the exposure dataset may not be present in the outcome dataset due to different GWAS using different genotyping arrays, impuation methods, and QC practices. To overcome this, proxy variants in the outcome dataset can be substituted for the missing variant.\nHere we first extract our exposure SNPs from the outcome GWAS and determine which SNPs are not presenting in the outcome dataset. We then query the LDLink web server to identify proxy variants that are in strong LD (r2) with the missing variant. The resulting proxy SNPs are then extracted from the outcome dataset and appended to the initial SNPs extracted from the outcome GWAS using munge_proxies() function.\n\n\nIdentify Proxy Variants\n# extract exposure SNPs present in outcome\noutcome_clump &lt;- semi_join(\n  outcome, exposure_dat, by = \"SNP\"\n)\n\n# Exposure SNPs not present in outomce\nexp_snps_wo &lt;- anti_join(\n  exposure_dat, outcome, by = \"SNP\"\n)\n\n# Use LDLinkR to identify proxy snps\nLDproxy_batch(exp_snps_wo$SNP, \n        pop = \"CEU\",             # Match population ancestries\n        r2d = \"r2\", \n        token = 'a6deee62cc4a', \n        append = TRUE,           # We appended the results of each LDlink query to a single file\n        genome_build = \"grch37\") # Select genome build based on summary stats\nsystem(\"mv combined_query_snp_list_grch37.txt data/exposure_outcome_proxy_snps.txt\")\n\n\n# Munge proxy snp file\noutcome_dat &lt;- munge_proxies(\"data/exposure_outcome_proxy_snps.txt\", outcome, outcome_clump)"
  },
  {
    "objectID": "scripts/mr_harmonization.html#harmonize-exposure---outcome-datasets",
    "href": "scripts/mr_harmonization.html#harmonize-exposure---outcome-datasets",
    "title": "3  Harmonizing SumStats",
    "section": "Harmonize Exposure - Outcome Datasets",
    "text": "Harmonize Exposure - Outcome Datasets\nFinally, the effect of a SNP on an outcome and exposure must be harmonised to be relative to the same allele. We also specify to infer the positive strand alleles, using allele frequencies for palindromes rather then removing palindromic variants.\n\n\nHarmonize\nmr_dat &lt;- harmonise_data(exposure_dat, outcome_dat, action = 2) %&gt;% as_tibble() %&gt;%\n#  mutate(\n#    apoe_region = case_when(\n#      chr.outcome == 19 & between(pos.outcome, 44912079, 45912079) ~ TRUE,\n#      TRUE ~ FALSE\n#    ), \n#    gws.outcome = ifelse(pval.outcome &lt; 5e-8, TRUE, FALSE), \n#   mr_keep = ifelse(mr_keep == FALSE | apoe_region == TRUE | gws.outcome == TRUE, FALSE, TRUE)\n#  )\n  filter(pval.exposure &lt; 5e-8)\n\n\n\n\n\n\n\n\nNote\n\n\n\nThe variable mr_keep is used to determine the SNPs to be included in the MR analysis. It is recommended to exclude variants with pval.outcome &lt; 5e-8 as they violate the exclusion restriction assumption. For studies involving Alzheimer’s disease, variants in the APOE region (GRCh37 - CHR: 19, BP: 44912079-45912079) should also be removed due to its large effect size and pleiotropic nature. However, in this tutorial, this step is not performed to demonstrate how causal estimates can be influenced by horizontal pleiotropy.\n\n\nAnd now we have a final harmonized dataset that can be used in our downstream MR analyses"
  },
  {
    "objectID": "scripts/mr_harmonization_II.html#exposure-dataset",
    "href": "scripts/mr_harmonization_II.html#exposure-dataset",
    "title": "4  Harmonizing SumStats II",
    "section": "Exposure dataset",
    "text": "Exposure dataset\nOur exposures of interest LDL cholesteral level, with GWAS summary statistics obtained from two separate GWAS conducted by the Global Lipid Genetics Consortium. The first GWAS, conducted by Willer et al. in 2013, included 188,577 individuals and identified 56 loci that were significantly associated with LDL cholesterol levels. The second GWAS, conducted by Graham et al. in 2021, included a much larger sample size of approximately 1.65 million individuals, which included 350,000 individuals of non-European ancestry. In the subset of individuals of European ancestry (n = 1,320,016), 403 loci were identified as being significantly associated with LDL cholesterol levels.\nThe process of importing and clumping the exposure datasets remains the same as before, except that now we are excluding rare variants with a minor allele frequency (MAF) of less than 0.01. This is done to reduce the file size.\n\n\nImport exposure GWAS SumStats\nexposure_paths = c(\n  \"resources/Graham2021ldl.chrall.CPRA_b37.tsv.gz\",\n  \"resources/Willer2013ldl.chrall.CPRA_b37.tsv.gz\" \n)\nexposures &lt;- str_extract(exposure_paths, \"(?&lt;=/).*(?=.chrall)\")\n\nexposure_ss &lt;- map(exposure_paths, function(x){\n  trait &lt;- str_extract(x, \"(?&lt;=/).*(?=.chrall)\")\n  \n  message(\"Imporing: \", x, \"....\")\n  ## Filter out problematic snps - MAF &gt; 1%, SNVs, rsid\n  ss &lt;- read_tsv(\n    x, comment = \"##\", col_types = coltypes,\n    col_select = c(DBSNP_ID, CHROM, POS, REF, ALT, AF, BETA, SE, Z, P, N, TRAIT))  %&gt;%\n    filter(between(AF, 0.01, 0.99)) %&gt;%\n    filter(nchar(REF) == 1 & nchar(ALT) == 1) %&gt;%\n    filter(!is.na(DBSNP_ID)) %&gt;%\n    mutate(TRAIT = trait)\n    \n  message(\"Standardizing: \", x, \"....\")\n   ss_out &lt;- ss %&gt;% format_data(.,\n      type = \"exposure\",\n      snps = NULL,\n      header = TRUE,\n      phenotype_col = \"TRAIT\",\n      snp_col = \"DBSNP_ID\",\n      beta_col = \"BETA\",\n      se_col = \"SE\",\n      eaf_col = \"AF\",\n      effect_allele_col = \"ALT\",\n      other_allele_col = \"REF\",\n      pval_col = \"P\",\n      samplesize_col = \"N\",\n      z_col = \"Z\",\n      chr_col = \"CHROM\",\n      pos_col = \"POS\",\n      log_pval = FALSE\n    ) %&gt;%\n    as_tibble()\n  \n   rm(ss) \n    ss_out\n  }) %&gt;%\n  magrittr::set_names(exposures)\n\n\n\n\nLD clump exposure\n# Perform LD clumping on SNP data, filter SNPs to make it run faster\nexposure_clump &lt;- map(exposure_ss, function(x){\n    x %&gt;% \n      filter(pval.exposure &lt; 1e-8) %&gt;%\n      clump_data(.,\n      clump_kb = 10000,\n      clump_r2 = 0.001,\n      clump_p1 = 1,\n      clump_p2 = 1,\n      pop = \"EUR\"\n  )\n}) \n\nexposure_dat &lt;- bind_rows(exposure_clump)"
  },
  {
    "objectID": "scripts/mr_harmonization_II.html#outcome-datasets",
    "href": "scripts/mr_harmonization_II.html#outcome-datasets",
    "title": "4  Harmonizing SumStats II",
    "section": "Outcome datasets",
    "text": "Outcome datasets\nOur outcomes consist of GWAS of clinical late onset Alzheimer’s disease by Kunkle et al 2019 and AD/dementia by Bellenguez et al 2022. Importing, identifying proxy variants, and harmonizing the datasets remains the same as before.\n\n\nImport outcome GWAS SumStats\noutcome_paths = c(\n  \"resources/Kunkle2019load_stage123.chrall.CPRA_b37.tsv.gz\", \n  \"resources/Bellenguez2022load.chrall.CPRA_b37.tsv.gz\"\n  )\n\noutcomes &lt;- str_extract(outcome_paths, \"(?&lt;=/).*(?=.chrall)\")\n\noutcome_ss &lt;- map(outcome_paths, function(x){\n  trait &lt;- str_extract(x, \"(?&lt;=/).*(?=.chrall)\")\n  \n  message(\"Imporing: \", x, \"....\")\n  ## Filter out problematic snps - MAF &gt; 1%, SNVs, rsid\n  ss &lt;- read_tsv(\n    x, comment = \"##\", col_types = coltypes, # n_max = 100,\n    col_select = c(DBSNP_ID, CHROM, POS, REF, ALT, AF, BETA, SE, Z, P, N, TRAIT))  %&gt;%\n    filter(between(AF, 0.01, 0.99)) %&gt;%\n    filter(nchar(REF) == 1 & nchar(ALT) == 1) %&gt;%\n    filter(!is.na(DBSNP_ID)) %&gt;%\n    mutate(TRAIT = trait)\n    \n  message(\"Standardizing: \", x, \"....\")\n   ss_out &lt;- ss %&gt;% format_data(.,\n      type = \"outcome\",\n      snps = NULL,\n      header = TRUE,\n      phenotype_col = \"TRAIT\",\n      snp_col = \"DBSNP_ID\",\n      beta_col = \"BETA\",\n      se_col = \"SE\",\n      eaf_col = \"AF\",\n      effect_allele_col = \"ALT\",\n      other_allele_col = \"REF\",\n      pval_col = \"P\",\n      samplesize_col = \"N\",\n      z_col = \"Z\",\n      chr_col = \"CHROM\",\n      pos_col = \"POS\",\n      log_pval = FALSE\n    ) %&gt;%\n    as_tibble()\n  \n   rm(ss) \n    ss_out\n  }) %&gt;%\n  magrittr::set_names(outcomes)\n\n\n\n\nIdentify Proxy Variants\n# extract exposure SNPs present in outcome\noutcome_clump &lt;- map(outcome_ss, function(x){\n    semi_join(\n      x, exposure_dat, by = \"SNP\"\n    )\n})\n\n# Exposure SNPs not present in outomce\nexp_snps_wo &lt;- map(outcome_ss, function(x){\n  anti_join(\n    exposure_dat, x, by = \"SNP\"\n  )\n})\n\n# Use LDLinkR to identify proxy snps\nmap2(exp_snps_wo, outcomes, function(x,y){\n  LDproxy_batch(x$SNP, \n        pop = \"CEU\",             # Match population ancestries\n        r2d = \"r2\", \n        token = 'a6deee62cc4a', \n        append = TRUE,           # We appended the results of each LDlink query to a single file\n        genome_build = \"grch37\") # Select genome build based on summary stats\n  \n  system(glue(\"mv combined_query_snp_list_grch37.txt data/exposure_{y}_proxy_snps.txt\"))\n  })\n\n# Munge proxy snp file\noutcome_dat &lt;- pmap(list(outcomes, outcome_ss, outcome_clump), \n                    function(file, sumstats, clumped){\n                      munge_proxies(glue(\"data/exposure_{file}_proxy_snps.txt\"), \n                                    sumstats, clumped)\n}) %&gt;%\n  bind_rows()\n\n\nDuring the harmonization step we are now flagging SNPs that are GWS for the outcome or that are located in the APOE region for removal.\n\n\nHarmonize\nmr_dat &lt;- harmonise_data(exposure_dat, test, action = 2) %&gt;% \n  as_tibble() %&gt;%\n   mutate(\n     apoe_region = case_when(\n       chr.outcome == 19 & between(pos.outcome, 44912079, 45912079) ~ TRUE,\n       TRUE ~ FALSE\n     ),\n     gws.outcome = ifelse(pval.outcome &lt; 5e-8, TRUE, FALSE),\n    mr_keep = ifelse(mr_keep == FALSE | apoe_region == TRUE | gws.outcome == TRUE, FALSE, TRUE)\n   )"
  },
  {
    "objectID": "scripts/mr.html#methods",
    "href": "scripts/mr.html#methods",
    "title": "5  TwoSampleMR",
    "section": "Methods",
    "text": "Methods\n\nTools & Publications\nR, TwoSampleMR, MendelianRandomization\n\nHemani, G. et al. The MR-Base platform supports systematic causal inference across the human phenome. Elife 7, e34408 (2018).\nYavorska, O. O. & Burgess, S. MendelianRandomization: an R package for performing Mendelian randomization analyses using summarized data. Int J Epidemiol 46, dyx034 (2017).\n\nIVW: The simplest method for MR causal effect estimation is the inverse variance weighted (IVW) meta-analysis of each genetic instrument’s Wald ratio. This is similar to conducting a weighted regression of SNP-exposure effects against SNP-outcome effects, with the regression line passing through the origin. Fixed effects IVW is the most powerful method for MR analysis and is widely accepted as the primary method. However, it assumes that there is no horizontal pleiotropy and is sensitive to violations of MR assumptions. Random effects IVW relaxes this assumption by allowing each SNP to have a different mean effect, providing an unbiased estimate if horizontal pleiotropy is present in a balanced manner.\nMaximum likelihood: The causal effect is estimated by direct maximization of the liklihood given the SNP-exposure and SNP-outcome effects and assuming a linear relationship between the exposure and outcome. May provide more reliable results in the presence of measurement error in the SNP-exposure effects, but assumes that there is no heterogeneity or horizontal pleiotropy.\nMR-Egger: The Inverse Variance Weighted (IVW) method can be modified to account for horizontal pleiotropy by including a non-zero intercept. This allows for an estimation of net horizontal pleiotropic effects even if they are not balanced or directional. However, this approach assumes that the horizontal pleiotropic effects are uncorrelated with the SNP-exposure effects, known as the InSIDE assumption. Despite this, the MR-Egger method may have lower precision, leading to a reduction in statistical power to detect causal relationships.\nMode Based Estimators: Clusters SNPs into groups based on similarity of their causal effects and returns the causal estimates based on the cluster with the largest number of SNPs. Weighting each SNPs contribution to the clustering by the inverse variance of its outcome of its outcome effect can be also be used. Returns an unbiased causal estimate when all the SNPs in the largest cluster are valid instruments.\nMedian Based Estimators: Estimating the causal effect by taking the median effect of all avaliable SNPs allows for only half the SNPs needing to be valid instruments. Weighting the contribution of each SNP by the inverse variance of its association with the outcome allows for stronger SNPs to contribute more towards the estimate."
  },
  {
    "objectID": "scripts/mr.html#perform-mr-analysis",
    "href": "scripts/mr.html#perform-mr-analysis",
    "title": "5  TwoSampleMR",
    "section": "Perform MR analysis",
    "text": "Perform MR analysis\n\n\nImport Data\nmr_dat &lt;- read_csv('data/harmonized_data.csv')\n\n\n\n\nMR analysis\nmr_res &lt;- mr(mr_dat, method_list = c(\n  \"mr_two_sample_ml\",  \"mr_egger_regression\", \"mr_egger_regression_bootstrap\",\n  \"mr_simple_median\", \"mr_weighted_median\", \"mr_penalised_weighted_median\", \n  \"mr_ivw_fe\", \"mr_ivw_mre\",\n  \"mr_simple_mode\", \"mr_weighted_mode\", \"mr_weighted_mode_nome\", \"mr_simple_mode_nome\"\n  ))\n\n\nMR analysis\nres_single &lt;- mr_singlesnp(mr_dat, all_method = c(\"mr_ivw_fe\", \"mr_egger_regression\", \"mr_weighted_median\", \"mr_weighted_mode\")) %&gt;% as_tibble()\n\n\nIn the fixed effects IVW analysis, higher genetically predicted total cholesteroal levels are associated with increased risk of Alzheimer’s disease. However, the majority of our pleiotropy robust methods are non-significant, suggesting that the causal effects may be biased.\n\n\n\n\n\n\n  \n    \n    \n      method\n      nsnp\n      b\n      se\n      pval\n    \n  \n  \n    Maximum likelihood\n84\n0.33\n0.04\n9.6 × 10−20\n    MR Egger\n84\n0.67\n0.19\n7.1 × 10−4\n    MR Egger (bootstrap)\n84\n−0.04\n0.07\n0.314\n    Simple median\n84\n0.01\n0.06\n0.908\n    Weighted median\n84\n0.05\n0.07\n0.454\n    Penalised weighted median\n84\n−0.03\n0.06\n0.689\n    Inverse variance weighted (fixed effects)\n84\n0.31\n0.03\n1.7 × 10−19\n    Inverse variance weighted (multiplicative random effects)\n84\n0.31\n0.12\n0.007\n    Simple mode\n84\n−0.05\n0.12\n0.689\n    Weighted mode\n84\n−0.05\n0.07\n0.488\n    Weighted mode (NOME)\n84\n−0.05\n0.08\n0.518\n    Simple mode (NOME)\n84\n−0.05\n0.13\n0.698\n  \n  \n  \n\n\n\n\nThe relationship between SNP effects on the exposure and SNP effects on the outcome can be visualized through a scatter plot. The slopes of the lines correspond to the estimated causal effect for each method.\n\n\nMR Scatter Plot\nscatter_p &lt;- mr_scatter_plot(mr_res, mr_dat) \n\n\nMR Scatter Plot\nscatter_out_p &lt;- scatter_p[[1]] + theme_bw() + \n  guides(color=guide_legend(ncol =1)) + \n  theme(\n    text = element_text(size = 8), \n  )\n\nscatter_out_p\n\n\n\n\n\nForest plots can be used to display the Wald ratio for single SNPs and their combined effects.\n\n\nMR Forrest Plot\nforrest_p &lt;- mr_forest_plot(res_single)\nforrest_p[[1]]"
  },
  {
    "objectID": "scripts/mr.html#diagnostics",
    "href": "scripts/mr.html#diagnostics",
    "title": "5  TwoSampleMR",
    "section": "Diagnostics",
    "text": "Diagnostics\nDiagnostics and sensetivity analyses are used to evaluate if the causal estimates are robust to violations of MR underlying assumptions.\n\nPleiotropy\nThe intercept term in MR-Egger regression can provide an indication of the presence of directional horizontal pleiotropy, and help to determine the robustness of the MR results. Directional horizontal pleiotropy refers to the situation where a genetic variant used as an instrumental variable in a Mendelian randomization (MR) study influences the exposure and outcome in the same direction. This can result in biased estimates of the causal effect of the exposure on the outcome, and compromise the validity of the MR results.\nWe observe that the MR-Egger regression intercept for Total cholesterol onto AD is significant, suggesting that the IVW causal estimate is biased by directional horizontal pleiotropy.\n\n\nPleiotropy\nres_pleio &lt;- mr_pleiotropy_test(mr_dat)\n\nres_pleio %&gt;%\n  select(-id.exposure, -id.outcome, -outcome, -exposure) %&gt;%\n  gt() %&gt;%\n  fmt_number(\n    columns = c('egger_intercept', 'se')\n  ) %&gt;%\n  fmt_number(\n    columns = pval,\n    rows = pval &gt; 0.001,\n    decimals = 3\n  ) %&gt;% \n  fmt_scientific(\n    columns = pval,\n    rows = pval &lt;= 0.001,\n    decimals = 1\n  )\n\n\n\n\n\n\n  \n    \n    \n      egger_intercept\n      se\n      pval\n    \n  \n  \n    −0.02\n0.01\n0.023\n  \n  \n  \n\n\n\n\n\n\nHeterogeneity\nHeterogeneity refers to the variability or diversity in the relationship between an exposure variable and an outcome variable across different genetic variants that are used as instrumental variables. Heterogeneity can arise due to several factors, including differences in the strength of the genetic associations with the exposure and outcome, differences in the direction of effect, or differences in the way that the genetic variants interact with other variables that may confound the relationship. Heterogeneity can pose a challenge for the validity of the MR results, as it may indicate that the assumption of a consistent relationship between the exposure and outcome across different SNPs is not met. If heterogeneity is present, it can indicate that the underlying causal relationship between the exposure and outcome is complex and cannot be captured by a single SNP or set of SNPs.\nWe can estimate heterogeneity using Cochran’s Q Test. We observe that there is significant heterogeneity in the IVW and MR-Egger analysis, further highlighting that the IVW causal estimates are likely biased.\n\n\nHeterogeneity\n# Heterogeneity statistics \nres_het &lt;- mr_heterogeneity(mr_dat, method_list = c(\"mr_egger_regression\", \"mr_ivw\"))\n\nres_het %&gt;%\n  select(-id.exposure, -id.outcome, -outcome, -exposure) %&gt;%\n  gt() %&gt;%\n  fmt_number(\n    columns = Q\n  ) %&gt;%\n  fmt_number(\n    columns = Q_pval,\n    rows = Q_pval &gt; 0.001,\n    decimals = 3\n  ) %&gt;% \n  fmt_scientific(\n    columns = Q_pval,\n    rows = Q_pval &lt;= 0.001,\n    decimals = 1\n  )\n\n\n\n\n\n\n  \n    \n    \n      method\n      Q\n      Q_df\n      Q_pval\n    \n  \n  \n    MR Egger\n862.04\n82\n2.1 × 10−130\n    Inverse variance weighted\n918.33\n83\n5.2 × 10−141\n  \n  \n  \n\n\n\n\nFunnel plots in which the estimate for each SNP is plotted against its precision can be used to visually inspect for horizontal pleitropy, with asymmetry indicative of invalid instruments.\n\n\nFunnel plots\nfunnel_p &lt;- mr_funnel_plot(res_single)\nfunnel_out_p &lt;- funnel_p[[1]] + theme_bw() + \n  guides(color=guide_legend(ncol =1)) + \n  theme(\n    text = element_text(size = 8), \n  )\n\nfunnel_out_p\n\n\n\n\n\n\n\nOutliers\nLeave-one-out analysis can be used to determine if a MR causal estimate is driven or biased by a single SNP that might have a particularly large horizontal pleiotropic effect. The MR causal effect is re-estimated by sequentially droping one SNP at a time.\nWe observe dramatic changes in the MR causal estimates when two SNPs - rs7412 and rs75687619 - are droped from the analysis. This suggests that the IVW estimate is particularly sensitive to the inclusion of these variants and that they are potentially outliers.\n\n\nLeave-one-out\n# Leave-one-out analysis \nres_loo &lt;- mr_leaveoneout(mr_dat, method = mr_ivw_fe) %&gt;% as_tibble()\n\nloo_p &lt;- mr_leaveoneout_plot(res_loo)\nloo_p[[1]]"
  },
  {
    "objectID": "scripts/mr.html#summary",
    "href": "scripts/mr.html#summary",
    "title": "5  TwoSampleMR",
    "section": "Summary",
    "text": "Summary\nIn the IVW analysis we observed that higher genetically predicted total cholesterol levels were causaly associated with an increased risk of Alzheimer’s disease. However, the majority of our sensitivity analysis are non-significant suggesting that our IVW estimated is biased. Furthermore, while the MR-Egger causal estimate is significant, this is likely due to violations of the InSIDE assumption. The robustness of our causal estimate is further called into question by the presense of significant heterogeneity, horizontal pleitropy, and outliers."
  },
  {
    "objectID": "scripts/radial_mr.html#methods",
    "href": "scripts/radial_mr.html#methods",
    "title": "6  Radial-MR",
    "section": "Methods",
    "text": "Methods\n\nTools & Publications\nR, RadialMR\n\nBowden, J., et al., Improving the visualization, interpretation and analysis of two-sample summary data Mendelian randomization via the Radial plot and Radial regression. International Journal of Epidemiology, 2018. 47(4): p. 1264-1278.\n\nRadial MR: Produces radial plots and performs radial regression for inverse variance weighted and MR-Egger regression models. These plots have the advantage of improving the visual detection of outliers, as well as being coding invariant. The contribution of each individule SNP to the Cochran’s Q statistic is quantified, with SNPs that have a large contribution been classified as outliers based on significance level selected by the user - typically a bonferonni correction. Outliers can be removed for downstream analysis."
  },
  {
    "objectID": "scripts/radial_mr.html#perform-radial-mr",
    "href": "scripts/radial_mr.html#perform-radial-mr",
    "title": "6  Radial-MR",
    "section": "Perform Radial MR",
    "text": "Perform Radial MR\nThe RadialMR package requires a different input data format to that of TwoSampleMR, so we first use TwoSampleMR::dat_to_RadialMR() to convert our TwoSampleMR harmonized data to the formate required by RadialMR.\n\n\nRadial MR\n# Format data \nradial_dat &lt;- mr_dat %&gt;% filter(mr_keep == T) %&gt;% dat_to_RadialMR()\nrmr_dat &lt;- radial_dat$TC.AD\n\n# Run Radial MR\nbonff = 0.05/nrow(rmr_dat) # Bonferonni Correction\nradial_ivw_res &lt;- ivw_radial(rmr_dat, alpha = bonff) \n\n\n\nRadial IVW\n\n                  Estimate  Std.Error   t value     Pr(&gt;|t|)\nEffect (Mod.2nd) 0.3140916 0.11586058  2.710944 6.709190e-03\nIterative        0.3140955 0.11586121  2.710964 6.708800e-03\nExact (FE)       0.3524370 0.03503782 10.058760 8.405058e-24\nExact (RE)       0.3179997 0.20118635  1.580622 1.177679e-01\n\n\nResidual standard error: 3.31 on 83 degrees of freedom\n\nF-statistic: 7.35 on 1 and 83 DF, p-value: 0.00815\nQ-Statistic for heterogeneity: 909.3152 on 83 DF , p-value: 3.196198e-139\n\n Outliers detected \nNumber of iterations = 3\n\n\nRadial MR\nradial_egger_res &lt;- egger_radial(rmr_dat, alpha = bonff) \n\n\n\nRadial MR-Egger\n\n              Estimate Std. Error   t value    Pr(&gt;|t|)\n(Intercept) -0.9612088  0.6654372 -1.444477 0.152415150\nWj           0.5755524  0.2154432  2.671482 0.009106335\n\nResidual standard error: 3.25 on 82 degrees of freedom\n\nF-statistic: 7.14 on 1 and 82 DF, p-value: 0.00911\nQ-Statistic for heterogeneity: 866.2584 on 82 DF , p-value: 1.007391e-130\n\n Outliers detected \n\n\nAs with our core MR methods, we observed that the Radial-MR causal estimates indicated that total cholesteroal is causaly associated with an increased risk of AD, however, there is significant heterogenity.\n\n\n\n\n\n\n  \n    \n    \n      \n      b\n      se\n      statistic\n      p\n    \n  \n  \n    \n      IVW\n    \n    Effect (Mod.2nd)\n0.31\n0.12\n2.71\n0.007\n    Iterative\n0.31\n0.12\n2.71\n0.007\n    Exact (FE)\n0.35\n0.04\n10.06\n8.4 × 10−24\n    Exact (RE)\n0.32\n0.20\n1.58\n0.118\n    Q-Statistic\nNA\nNA\n909.32\n3.2 × 10−139\n    \n      Egger\n    \n    (Intercept)\n−0.96\n0.67\n−1.44\n0.152\n    Wj\n0.58\n0.22\n2.67\n0.009\n    Q-Statistic\nNA\nNA\n866.26\n1.0 × 10−130\n  \n  \n  \n\n\n\n\nExamining the Radial Plots we also further observe a number of variants were classifed as outliers, which are determined with respect to their contribution to global heterogeneity as quantified by Cochran’s Q-statistic and using a a bonferonni corrected significance threshold.\n\n\nRadial Plots\nivw_radial_p &lt;- plot_radial(radial_ivw_res, radial_scale = F, show_outliers = F)\negger_radial_p &lt;- plot_radial(radial_egger_res, radial_scale = F, show_outliers = F)\n\ncowplot::plot_grid(\n  ivw_radial_p + coord_fixed(ratio=0.25) + theme(legend.position = 'bottom'), \n   egger_radial_p + theme(legend.position = 'bottom'), \n  align = 'h'\n)\n\n\n\n\n\nThe IVW Radial MR method identified six variants as potential outliers. We can query PhenoScanner to obtain further information on these SNPs (and variants they are in LD with) including what other traits they have been associated with.\n\n\nRemove outliers\n# Phenoscanner \nphewas_dat &lt;- phenoscanner(\n  snpquery=radial_ivw_res$outliers$SNP, \n  proxies='EUR', \n  r2 = 0.8\n  ) \n\n\nPhenoScanner V2\nCardiovascular Epidemiology Unit\nUniversity of Cambridge\nEmail: phenoscanner@gmail.com\n\nInformation: Each user can query a maximum of 10,000 SNPs (in batches of 100), 1,000 genes (in batches of 10) or 1,000 regions (in batches of 10) per hour. For large batch queries, please ask to download the data from www.phenoscanner.medschl.cam.ac.uk/data.\nTerms of use: Please refer to the terms of use when using PhenoScanner V2 (www.phenoscanner.medschl.cam.ac.uk/about). If you use the results from PhenoScanner in a publication or presentation, please cite all of the relevant references of the data used and the PhenoScanner publications: www.phenoscanner.medschl.cam.ac.uk/about/#citation.\n\n[1] \"1 -- chunk of 10 SNPs queried\"\n\n\nRemove outliers\nradial_ivw_res$outliers %&gt;%\n  left_join(filter(phewas_dat$snps, snp == rsid), by = c(\"SNP\" = \"snp\")) %&gt;%\n  select(SNP, Q_statistic, p.value, hg19_coordinates, a1, a2, hgnc) %&gt;%\n  reactable()\n\n\n\n\n\n\n\nExamining the PheWAS results, we can see that three of the outliers (rs7412, rs7568769, and rs8103315) are all located within the APOE region and associated with Alzheimer’s disease. These are the same variants that were previously observed to be driving the IVW causal estimates from the Leave-one-out anlaysis.\n\n\n\n\n\n\n\nNow that have identified outliers, we can re-run our core MR methods with outliers removed. We join the radial MR results to our harmonized dataset and modify the mr_keep variable to flag outliers for removal.\n\n\nRemove outliers\n## Modify the mrkeep variable to flag variants as outliers from radial MR for removal\nmr_dat_outlier &lt;- mr_dat %&gt;%\n  left_join(radial_ivw_res$dat) %&gt;%\n  mutate(\n     mr_keep = case_when(\n       Outliers == \"Outlier\" ~ FALSE, \n       TRUE ~ mr_keep\n     )\n  )\n\n\nAfter removing outliers, the IVW estimates are no longer significant.\n\n\nMR analysis w/o outliers\n# Standard MR\nmr_res &lt;- mr(mr_dat, method_list = c(\n  c(\"mr_ivw_fe\", \"mr_egger_regression\", \"mr_weighted_median\", \"mr_weighted_mode\")\n  ))\n\n## MR analysis \nmr_res_outlier &lt;- mr(mr_dat_outlier, method_list = c(\"mr_ivw_fe\", \"mr_egger_regression\", \"mr_weighted_median\", \"mr_weighted_mode\"))\n\n# Heterogeneity statistics \nmr_het_outlier &lt;- mr_heterogeneity(mr_dat_outlier, method_list = c(\"mr_egger_regression\", \"mr_ivw\"))\n\n# Horizontal pleitropy\nmr_plt_outlier &lt;- mr_pleiotropy_test(mr_dat_outlier)\n\n# Radial MR \nradial_dat_outlier &lt;- mr_dat_outlier %&gt;% filter(mr_keep == T) %&gt;% dat_to_RadialMR()\nradial_res_outlier &lt;- ivw_radial(radial_dat_outlier$TC.AD, alpha = 0.05/nrow(radial_dat_outlier$TC.AD)) \n\n\n\nRadial IVW\n\n                     Estimate  Std.Error    t value  Pr(&gt;|t|)\nEffect (Mod.2nd) -0.007293342 0.05138246 -0.1419423 0.8871256\nIterative        -0.007293342 0.05138246 -0.1419423 0.8871256\nExact (FE)       -0.007407696 0.04038259 -0.1834379 0.8544545\nExact (RE)       -0.007357159 0.04651487 -0.1581679 0.8747386\n\n\nResidual standard error: 1.272 on 77 degrees of freedom\n\nF-statistic: 0.02 on 1 and 77 DF, p-value: 0.887\nQ-Statistic for heterogeneity: 124.6615 on 77 DF , p-value: 0.0004808313\n\n Outliers detected \nNumber of iterations = 2\n\n\nMR analysis w/o outliers\nbind_rows(\n  mr_res %&gt;% mutate(model = \"w/ Outliers\"), \n  mr_res_outlier %&gt;% mutate(model = \"w/o Outliers\")) %&gt;%\n  select(model, method, nsnp, b, se, pval) %&gt;%\n  gt(\n    groupname_col = \"model\"\n  ) %&gt;%\n  fmt_number(\n    columns = c(\"b\", \"se\")\n  ) %&gt;%\n  fmt_number(\n    columns = pval,\n    rows = pval &gt; 0.001,\n    decimals = 3\n  ) %&gt;% \n  fmt_scientific(\n    columns = pval,\n    rows = pval &lt;= 0.001,\n    decimals = 1\n  ) \n\n\n\n\n\n\n  \n    \n    \n      method\n      nsnp\n      b\n      se\n      pval\n    \n  \n  \n    \n      w/ Outliers\n    \n    Inverse variance weighted (fixed effects)\n84\n0.31\n0.03\n1.7 × 10−19\n    MR Egger\n84\n0.67\n0.19\n7.1 × 10−4\n    Weighted median\n84\n0.05\n0.07\n0.434\n    Weighted mode\n84\n−0.05\n0.07\n0.490\n    \n      w/o Outliers\n    \n    Inverse variance weighted (fixed effects)\n78\n−0.01\n0.04\n0.857\n    MR Egger\n78\n−0.15\n0.10\n0.131\n    Weighted median\n78\n−0.02\n0.06\n0.776\n    Weighted mode\n78\n−0.03\n0.07\n0.631\n  \n  \n  \n\n\n\n\nThis is even more apparant when inspect the scatter and radial plots before and after outlier removal.\n\n\nMR plots w/o outliers\n# Plots\nscatter_p &lt;- mr_scatter_plot(mr_res, mr_dat) \nscatter_out_p &lt;- scatter_p[[1]] + theme_bw() + \n  guides(color=guide_legend(nrow =1)) + \n  labs(title = \"w/ outliers\") +\n  theme(\n    text = element_text(size = 8), \n    legend.position = 'bottom'\n  )\n\nscatter_outlier_p &lt;- mr_scatter_plot(mr_res_outlier, mr_dat_outlier)\n\nscatter_outlier_out_p &lt;- scatter_outlier_p[[1]] + theme_bw() + \n  guides(color=guide_legend(nrow =1)) + \n  labs(title = \"w/o outliers\") +\n  theme(\n    text = element_text(size = 8), \n    legend.position = 'bottom'\n  )\n\nradial_outlier_p &lt;- plot_radial(radial_res_outlier, radial_scale = F, show_outliers = F)\n\ncowplot::plot_grid(\n  scatter_out_p + theme(legend.position = 'none'), \n  scatter_outlier_out_p + theme(legend.position = 'none'), \n  ivw_radial_p + coord_fixed(ratio=0.25) + theme(legend.position = 'none') + labs(title = \"w/ outliers\"),\n  radial_outlier_p + coord_fixed(ratio=0.2) + theme(legend.position = 'none') + labs(title = \"w/o outliers\") \n)"
  },
  {
    "objectID": "scripts/radial_mr.html#the-apoe-region",
    "href": "scripts/radial_mr.html#the-apoe-region",
    "title": "6  Radial-MR",
    "section": "The APOE region",
    "text": "The APOE region\nIn the initial analysis, six SNPs were identified as potential outliers by Radial-MR. Three of these SNPs were located in the APOE region, known for its large effect size and pleiotropic nature, and were clear outliers based on their Q-statistics. In contrast the other three variants were located elsewhere on the genome and had significanlty smaller Q-statistics. It is possible that the large contribution of the individules APOE variants to the global heterogenity statistcs could be biasing the Q-statistics of other variants.\n\n\nRadial MR w/o APOE\nmr_dat_wo_apoe &lt;- mr_dat %&gt;%\n mutate(\n   apoe_region = case_when(\n     chr.outcome == 19 & between(pos.outcome, 44912079, 45912079) ~ TRUE,\n     TRUE ~ FALSE\n   ),\n   gws.outcome = ifelse(pval.outcome &lt; 5e-8, TRUE, FALSE),\n   mr_keep = case_when(\n       apoe_region == TRUE ~ FALSE, \n       gws.outcome == TRUE ~ FALSE, \n       TRUE ~ mr_keep\n     )\n )\n\n# Radial MR \nradial_dat_wo_apoe &lt;- mr_dat_wo_apoe %&gt;% filter(mr_keep == T) %&gt;% dat_to_RadialMR()\nradial_res_wo_apoe &lt;- ivw_radial(radial_dat_wo_apoe$TC.AD, alpha = 0.05/nrow(radial_dat_wo_apoe$TC.AD)) \n\n\n\nRadial IVW\n\n                    Estimate  Std.Error    t value  Pr(&gt;|t|)\nEffect (Mod.2nd) -0.04916017 0.05347782 -0.9192629 0.3579581\nIterative        -0.04916017 0.05347782 -0.9192629 0.3579581\nExact (FE)       -0.04997953 0.03907883 -1.2789412 0.2009178\nExact (RE)       -0.04961546 0.05031630 -0.9860712 0.3270712\n\n\nResidual standard error: 1.368 on 80 degrees of freedom\n\nF-statistic: 0.85 on 1 and 80 DF, p-value: 0.361\nQ-Statistic for heterogeneity: 149.8155 on 80 DF , p-value: 3.737286e-06\n\n Outliers detected \nNumber of iterations = 2\n\n\nRadial MR w/o APOE\nradial_wo_apoe_p &lt;- plot_radial(radial_res_wo_apoe, radial_scale = F, show_outliers = F)\n\n\nWhen the APOE region was removed before conducting radial MR, only two SNPs were now flagged as outliers. These were rs6504872, which was still considered an outlier after removing the APOE region, and a new variant, rs9391858, which emerged as an outlier after this step. This suggests that including the APOE region can bias the Q-statistics of other variants.\n\n\nRadial MR Plots w/o APOE\ncowplot::plot_grid(\n  ivw_radial_p + coord_fixed(ratio=0.25) + theme(legend.position = 'none') + labs(title = \"w/ APOE\"),\n  radial_wo_apoe_p + coord_fixed(ratio=0.2) + theme(legend.position = 'none') + labs(title = \"w/o APOE\"), \n  align = 'h'\n)"
  },
  {
    "objectID": "scripts/radial_mr.html#summary",
    "href": "scripts/radial_mr.html#summary",
    "title": "6  Radial-MR",
    "section": "Summary",
    "text": "Summary\nRadial-MR provides an improved visual interpretion of MR analyses and displayes data points with large contributions to Cochran’s Q statistic that are likely to be outliers. Based on this statistical criterion, indivdual variants can be removed from downstream MR analyses to obtain more robust causal estitmates. However, care should be taken when adopting a strategy of removing all outliers until little or no heterogeneity remains. This is highlighted when considering the APOE region, which caused additional variants to be classifed as outliers despite haveing moderate Q-statistics. Exclusion of a particular SNPs should additionaly be based on whether the SNP is associated with separate phenotypes that represent a pleiotropic pathways to the outcome."
  },
  {
    "objectID": "scripts/mvmr.html#methods",
    "href": "scripts/mvmr.html#methods",
    "title": "7  Multivariable MR",
    "section": "Methods",
    "text": "Methods\n\nTools & Publications\nR, MVMR, RMVMR, TwoSampleMR, MendelianRandomization\n\nHemani, G. et al. The MR-Base platform supports systematic causal inference across the human phenome. Elife 7, e34408 (2018)\nYavorska, O. O. & Burgess, S. MendelianRandomization: an R package for performing Mendelian randomization analyses using summarized data. Int J Epidemiol 46, dyx034 (2017).\nSanderson, E., Spiller, W. & Bowden, J. Testing and correcting for weak and pleiotropic instruments in two‐sample multivariable Mendelian randomization. Stat Med 40, 5434–5452 (2021).\nWoolf, B., Gill, D., Grant, A. J. & Burgess, S. MVMRmode: Introducing an R package for plurality valid estimators for multivariable Mendelian randomisation. medRxiv (2023).\n\nMultivariable MR: Used to estimate the causal relationships between multiple exposures and a single outcome. It is particularly useful in situations where multiple exposures are related and have potential inter-related effects on the outcome of interest. MVMR can help to disentangle the complex relationships between these exposures and provide insights into their independent causal effects. Examples of situations where MVMR can be useful include the estimation of the independent effects of related risk factors such as lipid fractions on an outcome, or the assessment of the independent effects of a primary risk factor and a secondary mediator on a disease outcome."
  },
  {
    "objectID": "scripts/mvmr.html#harmonizing-sumstats-for-mvmr",
    "href": "scripts/mvmr.html#harmonizing-sumstats-for-mvmr",
    "title": "7  Multivariable MR",
    "section": "Harmonizing SumStats for MVMR",
    "text": "Harmonizing SumStats for MVMR\nMVMR involves the simultaneous use of multiple exposures as instrumental variables in the analysis of a single outcome. As such, harmonizing the exposure and outcome datasets for MVMR is a more complex process than in univariable MR as it requires conducting multiple clumping and proxy-variant procedures. The following is a step-by-step guide to harmonizing the exposure and outcome datasets for MVMR using LDL and HDL cholesterol levels as the exposures, and AD as the outcome.\n\nImport datasets\n\n\nImport LDL SumStats\nexposure1_path = \"resources/Willer2013ldl.chrall.CPRA_b37.tsv.gz\"\nexposure1_ss &lt;- read_tsv(exposure1_path, comment = \"##\", col_types = coltypes, \n                       col_select = c(DBSNP_ID, CHROM, POS, REF, ALT, AF, BETA, SE, Z, P, N, TRAIT))\n\n# Format data to TwoSampleMR format\nexposure1 &lt;- exposure1_ss %&gt;%\n  format_data(.,\n    type = \"exposure\",\n    snps = NULL,\n    header = TRUE,\n    phenotype_col = \"TRAIT\",\n    snp_col = \"DBSNP_ID\",\n    beta_col = \"BETA\",\n    se_col = \"SE\",\n    eaf_col = \"AF\",\n    effect_allele_col = \"ALT\",\n    other_allele_col = \"REF\",\n    pval_col = \"P\",\n    samplesize_col = \"N\",\n    z_col = \"Z\",\n    chr_col = \"CHROM\",\n    pos_col = \"POS\",\n    log_pval = FALSE\n) %&gt;%\n  as_tibble()\n\n\n\n\nImport HDL SumStats\nexposure2_path = \"resources/Willer2013hdl.chrall.CPRA_b37.tsv.gz\"\nexposure2_ss &lt;- read_tsv(exposure2_path, comment = \"##\", col_types = coltypes, \n                       col_select = c(DBSNP_ID, CHROM, POS, REF, ALT, AF, BETA, SE, Z, P, N, TRAIT))\n\n# Format data to TwoSampleMR format\nexposure2 &lt;- exposure2_ss %&gt;%\n  format_data(.,\n    type = \"exposure\",\n    snps = NULL,\n    header = TRUE,\n    phenotype_col = \"TRAIT\",\n    snp_col = \"DBSNP_ID\",\n    beta_col = \"BETA\",\n    se_col = \"SE\",\n    eaf_col = \"AF\",\n    effect_allele_col = \"ALT\",\n    other_allele_col = \"REF\",\n    pval_col = \"P\",\n    samplesize_col = \"N\",\n    z_col = \"Z\",\n    chr_col = \"CHROM\",\n    pos_col = \"POS\",\n    log_pval = FALSE\n) %&gt;%\n  as_tibble()\n\n\n\n\nImport AD SumStats\noutcome_path = \"resources/Kunkle2019load_stage123.chrall.CPRA_b37.tsv.gz\"\noutcome_ss &lt;- read_tsv(outcome_path, comment = \"##\",  col_types = coltypes, \n                       col_select = c(DBSNP_ID, CHROM, POS, REF, ALT, AF, BETA, SE, Z, P, N, TRAIT))\n\n# Format outcome\noutcome &lt;- outcome_ss %&gt;%\n  format_data(.,\n    type = \"outcome\",\n    snps = NULL,\n    header = TRUE,\n    phenotype_col = \"TRAIT\",\n    snp_col = \"DBSNP_ID\",\n    beta_col = \"BETA\",\n    se_col = \"SE\",\n    eaf_col = \"AF\",\n    effect_allele_col = \"ALT\",\n    other_allele_col = \"REF\",\n    pval_col = \"P\",\n    samplesize_col = \"N\",\n    z_col = \"Z\",\n    chr_col = \"CHROM\",\n    pos_col = \"POS\",\n    log_pval = FALSE\n) %&gt;%\n  as_tibble()\n\n\n\n\nExposures\n\n\nClump Exposure datasets\n# Clump ldl\nexposure1_clump &lt;- exposure1 %&gt;% \n  filter(pval.exposure &lt; 0.01) %&gt;%\n  clump_data(.,\n  clump_kb = 10000,\n  clump_r2 = 0.001,\n  clump_p1 = 1,\n  clump_p2 = 1,\n  pop = \"EUR\"\n)\n\nexposure1_dat &lt;- filter(exposure1_clump, pval.exposure &lt; 5e-8)\n\n# Clump HDL\nexposure2_clump &lt;- exposure2 %&gt;% \n  filter(pval.exposure &lt; 0.01) %&gt;%\n  clump_data(.,\n  clump_kb = 10000,\n  clump_r2 = 0.001,\n  clump_p1 = 1,\n  clump_p2 = 1,\n  pop = \"EUR\"\n)\n\nexposure2_dat &lt;- filter(exposure2_clump, pval.exposure &lt; 5e-8)\n\n\nPerform clumping to obtain independent genome-wide significant variants for each exposure. This step involves identifying the SNPs that are independently associated with each exposure and are significant at the genome-wide level.\nThere are 79 and 89 independent genome-wide significant SNPS for LDL and HDL respectivly.\n\n\nCombine Exposures\n## Make list of distinct SNPs from the exposures independent GWS snps \nmvmr_snps &lt;- bind_rows(\n  select(exposure1_dat, SNP), \n  select(exposure2_dat, SNP), \n) %&gt;%\n  distinct(SNP) %&gt;%\n  pull(SNP)\n\n## extract combined SNP list from exposure datasets \ncomb_exp &lt;- bind_rows(\n  exposure1 %&gt;% filter(SNP %in% mvmr_snps),\n  exposure2 %&gt;% filter(SNP %in% mvmr_snps),\n)\n\n\nCombine the exposure SNP lists and extract all the SNPs from each exposure. This step combines the lists of SNPs for each exposure and extracts all the SNPs that are present in each exposure.\n\n\nCombine Exposures\n## Unique SNP ids across exposures\nexp_snp_list &lt;- full_join(\n  select(exposure1_dat, SNP, exposure), \n  select(exposure2_dat, SNP, exposure), \n  by = 'SNP'\n)\n\nexp1_unq_snps &lt;- filter(exp_snp_list, !is.na(exposure.x) & is.na(exposure.y)) %&gt;% nrow()\nexp2_unq_snps &lt;- filter(exp_snp_list, !is.na(exposure.y) & is.na(exposure.x)) %&gt;% nrow()\nboth_unq_snps &lt;- filter(exp_snp_list, !is.na(exposure.y) & !is.na(exposure.x)) %&gt;% nrow()\n\n\nThere are 164 unique SNPs across the LDL and HDL SNP list - 75 unique to LDL, 85 to HDL, and 4 that are shared.\nExtracting these 164 SNPs from the LDL and HDL SumStats we get the following count of genome-wide significant SNPs across both traits.\n\n\nCombined Exposure SNPs\n## exposure and outcome snps lists \ncomb_exp_out &lt;- bind_rows(\n  exposure1 %&gt;% filter(SNP %in% mvmr_snps) %&gt;% \n    rename(pval = pval.exposure, trait = exposure, chr = chr.exposure, pos = pos.exposure), \n  exposure2 %&gt;% filter(SNP %in% mvmr_snps) %&gt;% \n    rename(pval = pval.exposure, trait = exposure, chr = chr.exposure, pos = pos.exposure), \n  outcome %&gt;% filter(SNP %in% mvmr_snps) %&gt;% \n    rename(pval = pval.outcome, trait = outcome, chr = chr.outcome, pos = pos.outcome)\n)\n\n## How many SNPs are GWS across the exposures \ncomb_exp_wide &lt;- comb_exp_out %&gt;%\n   arrange(chr, pos) %&gt;%\n   select(SNP, trait, pval) %&gt;%\n   pivot_wider(names_from = trait, values_from = pval) %&gt;%\n   mutate(pval.exposure = pmin(LDL, HDL, na.rm = T))\n\ncomb_exp_wide %&gt;% count(LDL &lt; 5e-8, HDL &lt; 5e-8)  %&gt;%\n  gt() \n\n\n\n\n\n\n\n\n\nLDL &lt; 5e-08\nHDL &lt; 5e-08\nn\n\n\n\n\nFALSE\nTRUE\n76\n\n\nTRUE\nFALSE\n64\n\n\nTRUE\nTRUE\n24\n\n\n\n\n\n\n\nIdentify proxy variants for any SNPs that are missing in each exposure. This step involves identifying proxy variants for any SNPs that are not present in each exposure dataset. This is necessary to ensure that the exposure datasets are complete and that all relevant SNPs are included in the analysis.\n\n\n\n\n\n\nNote\n\n\n\nThere are no missing variants between the LDL &HDL SumStats, as such there is no need identify proxy variants\n\n\nPerform LD clumping on the combined SNP list to retain indepdent SNPs. This step is performed to reduce the risk of spurious results arising due to multi-collinearity by including correlated SNPs. LD clumping identifies lead SNPs in each locus and discards the remaining SNPs that are in linkage disequilibrium with them.\n\n\nClump Combined Exposures\n## Do another round of LD clumping \nclump_comb_exp &lt;- comb_exp_wide %&gt;% \n  clump_data(.,\n  clump_kb = 10000,\n  clump_r2 = 0.001,\n  clump_p1 = 1,\n  clump_p2 = 1,\n  pop = \"EUR\"\n)\n\ncomb_exp_independent &lt;- comb_exp %&gt;% filter(SNP %in% clump_comb_exp$SNP) \n\n\nDue to the high correlation among genetic variants, the GWAS of HDL and LDL may identify loci in the same genomic region. After LD clumping on the smallest p-value from the exposures, we retained 136 of the initial 164 SNPs, ensuring that we included only independent variants in the analysis.\n\n\n\n\n\n\n\n\n\nLDL &lt; 5e-08\nHDL &lt; 5e-08\nn\n\n\n\n\nFALSE\nTRUE\n66\n\n\nTRUE\nFALSE\n57\n\n\nTRUE\nTRUE\n13\n\n\n\n\n\n\n\n\n\nOutcome\nExtract exposures SNPs from the outcome GWAS. This step involves extracting the SNPs that are associated with the exposures from the genome-wide association study of the outcome.\n\n\nExtract Exposure SNPs from Outcome\n# extract exposure SNPs present in outcome\noutcome_clump &lt;- semi_join(\n  outcome, comb_exp_independent, by = \"SNP\"\n)\n\n# Exposure SNPs not present in outomce\noutcome_wo_snps &lt;- anti_join(\n  comb_exp_independent, outcome, by = \"SNP\"\n) %&gt;%\n  distinct(SNP)\n\n\nOf the 136 exposures SNPs, 135 are available in the AD SumStats - with 1 variant missing.\n\n\n\n\n\n\nNote\n\n\n\nOne issue to be aware of is that 3 of the exposure SNPs are GWS for AD and are violating the exclusion restriction assumption.\n\n\n\n\n\n\n\n\n\n\n\nLDL &lt; 5e-08\nHDL &lt; 5e-08\nAD &lt; 5e-08\nn\n\n\n\n\nFALSE\nTRUE\nFALSE\n65\n\n\nFALSE\nTRUE\nNA\n1\n\n\nTRUE\nFALSE\nFALSE\n55\n\n\nTRUE\nFALSE\nTRUE\n2\n\n\nTRUE\nTRUE\nFALSE\n12\n\n\nTRUE\nTRUE\nTRUE\n1\n\n\n\n\n\n\n\nIdentify proxy variants for any SNPs that missing in the outcome. This step involves identifying proxy variants for any SNPs that are not present in the outcome dataset. This is necessary to ensure that the outcome dataset is complete and that all relevant SNPs are included in the analysis.\n\n\nExtract proxy SNPs for outcome\n# Use LDLinkR to identify proxy snps\nLDproxy_batch(outcome_wo_snps, \n        pop = \"CEU\", \n        r2d = \"r2\", \n        token = 'a6deee62cc4a', \n        append = TRUE,\n        genome_build = \"grch37\")\n\n\n\nSubmitting request for query variant rs2729816.\nChecking status of server...Combined file for all query variants saved to:\n/Users/sheaandrews/gitcode/MR-tutorial/combined_query_snp_list_grch37.txt\n\n\nExtract proxy SNPs for outcome\nsystem(\"mv combined_query_snp_list_grch37.txt data/mvmr_proxy_snps.txt\")\n\n# Munge proxy snp file\noutcome_dat &lt;- munge_proxies(\"data/mvmr_proxy_snps.txt\", outcome, outcome_clump)\n\n\n\n\nHarmonize\nHarmonize exposure and outcome datasets. In order to perform MR the effect of a SNP on an outcome and exposure must be harmonised to be relative to the same allele.\n\n\nHarmonize exposure and outcome datasets\n# Univariate MR \nmrdat &lt;- harmonise_data(comb_exp, outcome_dat) %&gt;%\n  as_tibble() %&gt;%\n  filter(pval.exposure &lt; 5e-8)\n\n## MVMR\nmvdat &lt;- mv_harmonise_data(comb_exp, outcome_dat)\n\n\n\n\nExport MVMR datasets\nwrite_csv(mrdat, 'data/harmonized_mvmr_uni.csv')\nwrite_rds(mvdat, 'data/harmonized_mvmr.rds')"
  },
  {
    "objectID": "scripts/mvmr.html#mvmr-analysis",
    "href": "scripts/mvmr.html#mvmr-analysis",
    "title": "7  Multivariable MR",
    "section": "MVMR Analysis",
    "text": "MVMR Analysis\n\nTwoSampleMR\n\n\nUnivariable MR\n## Univariate MR\nmr_res &lt;- mr(mrdat, method_list = c(\"mr_ivw_fe\", \"mr_egger_regression\", \"mr_weighted_median\", \"mr_weighted_mode\"))\n\n# Heterogeneity statistics \nhet_res &lt;- mr_heterogeneity(mrdat, method_list = c(\"mr_egger_regression\", \"mr_ivw\"))\n\n# Horizontal pleitropy\nplei_res &lt;- mr_pleiotropy_test(mrdat)\n\n# Leave-one-out analysis \nres_loo &lt;- mr_leaveoneout(mrdat, method = mr_ivw_fe) %&gt;% as_tibble()\n\n# Single SNP anlaysis \nres_single &lt;- mr_singlesnp(mrdat, all_method = c(\"mr_ivw_fe\", \"mr_egger_regression\", \"mr_weighted_median\", \"mr_weighted_mode\")) %&gt;% as_tibble()\n\n# Radial MR \nradial_dat &lt;- mrdat %&gt;% filter(mr_keep == T) %&gt;% dat_to_RadialMR()\nradial_res &lt;- map(radial_dat, function(x){\n    ivw_radial(x, alpha = 0.05/nrow(x))\n  }\n)\n\n\n\nRadial IVW\n\n                   Estimate  Std.Error   t value     Pr(&gt;|t|)\nEffect (Mod.2nd) -0.1223808 0.11024660 -1.110064 0.2669712358\nIterative        -0.1223809 0.11024665 -1.110065 0.2669710759\nExact (FE)       -0.1365797 0.04139487 -3.299436 0.0009687925\nExact (RE)       -0.1242786 0.09937333 -1.250623 0.2149596925\n\n\nResidual standard error: 2.664 on 75 degrees of freedom\n\nF-statistic: 1.23 on 1 and 75 DF, p-value: 0.271\nQ-Statistic for heterogeneity: 532.1109 on 75 DF , p-value: 4.739116e-70\n\n Outliers detected \nNumber of iterations = 3\n\nRadial IVW\n\n                  Estimate Std.Error  t value     Pr(&gt;|t|)\nEffect (Mod.2nd) 0.2897672 0.1082519 2.676786 7.433216e-03\nIterative        0.2897684 0.1082525 2.676782 7.433288e-03\nExact (FE)       0.3190728 0.0356857 8.941193 3.849920e-19\nExact (RE)       0.2930763 0.1527847 1.918230 5.934461e-02\n\n\nResidual standard error: 3.035 on 67 degrees of freedom\n\nF-statistic: 7.17 on 1 and 67 DF, p-value: 0.00934\nQ-Statistic for heterogeneity: 617.3408 on 67 DF , p-value: 5.309971e-90\n\n Outliers detected \nNumber of iterations = 3\n\n\nUsing the core univariable MR methods, we observe that higher genetically predicted LDL and HDL are associated with increased and reduced risk of AD respectively.\n\n\n\n\n\n\n\nUnivariable MR Results \n\n\noutcome\nexposure\nmethod\nnsnp\nb\nse\npval\n\n\n\n\nAD\nLDL\nInverse variance weighted (fixed effects)\n68\n0.29\n0.04\n3.3 × 10−16\n\n\nAD\nLDL\nMR Egger\n68\n0.56\n0.16\n6.6 × 10−4\n\n\nAD\nLDL\nWeighted median\n68\n0.05\n0.06\n0.451\n\n\nAD\nLDL\nWeighted mode\n68\n0.01\n0.06\n0.901\n\n\nAD\nHDL\nInverse variance weighted (fixed effects)\n76\n−0.12\n0.04\n0.003\n\n\nAD\nHDL\nMR Egger\n76\n−0.25\n0.20\n0.214\n\n\nAD\nHDL\nWeighted median\n76\n0.00\n0.07\n0.998\n\n\nAD\nHDL\nWeighted mode\n76\n−0.02\n0.07\n0.795\n\n\n\n\n\n\n\nHowever, as with total cholesterol levels we observe significant heterogeneity suggesting that the IVW estimates are likely to be biased.\n\n\n\n\n\n\n\nHeterogenity tests for univariable MR \n\n\noutcome\nexposure\nmethod\nQ\nQ_df\nQ_pval\n\n\n\n\nAD\nLDL\nMR Egger\n576.56\n66\n1.4 × 10−82\n\n\nAD\nLDL\nInverse variance weighted\n623.54\n67\n3.3 × 10−91\n\n\nAD\nHDL\nMR Egger\n528.75\n74\n7.5 × 10−70\n\n\nAD\nHDL\nInverse variance weighted\n533.03\n75\n3.2 × 10−70\n\n\n\n\n\n\n\n\n\n\n\n\n\n\nEgger intercept tests for pleiotropy \n\n\noutcome\nexposure\negger_intercept\nse\npval\n\n\n\n\nAD\nLDL\n−0.02\n0.01\n0.024\n\n\nAD\nHDL\n0.01\n0.01\n0.442\n\n\n\n\n\n\n\n\n\nPlots for MR results\nscatter_p &lt;- mr_scatter_plot(mr_res, mrdat)\n\nfunnel_p &lt;- mr_funnel_plot(res_single)\n\nradial_p &lt;-  map(radial_res, function(x){\n     plot_radial(x, radial_scale = F, show_outliers = F)\n  }\n)\n\njoint_mr_p &lt;- cowplot::plot_grid(\n  scatter_p[[1]] + labs(title = \"LDL\") + theme_bw() + theme(legend.position = 'none', text = element_text(size = 8)),\n  funnel_p[[1]] + labs(title = \"LDL\") + theme_bw() + theme(legend.position = 'none', text = element_text(size = 8)), \n  radial_p[[2]] + labs(title = \"LDL\") + coord_fixed(ratio=0.25) + theme(legend.position = 'none', text = element_text(size = 6)), \n  scatter_p[[2]] + labs(title = \"HDL\") + theme_bw() + theme(legend.position = 'none', text = element_text(size = 8)), \n  funnel_p[[2]] + labs(title = \"HDL\") + theme_bw() + theme(legend.position = 'none', text = element_text(size = 8)),\n  radial_p[[1]] + labs(title = \"HDL\") + coord_fixed(ratio=0.25) + theme(legend.position = 'none', text = element_text(size = 6))\n  )\n\n\nlegend_scatter &lt;- cowplot::get_legend(\n  # create some space to the left of the legend\n  scatter_p[[1]] + theme(legend.box.margin = margin(12, 12, 12, 12))\n)\n\n# add the legend to the row we made earlier. Give it one-third of \n# the width of one plot (via rel_widths).\nscatter_out.p &lt;- cowplot::plot_grid(joint_mr_p, legend_scatter, rel_heights = c(4, 1), nrow = 2)\nscatter_out.p\n\n\n\n\n\nExtending these analyses into a multivariable framework we are able to determine the independent effects of LDL and HDL cholesterol levels on AD. We observed that higher genetically predicted LDL remains significantly causally associated with increased AD risk, while the causal effect of HDL on AD is now non-significant.\n\n\nMVMR analysis\nmvmr_res &lt;- mv_multiple(mvdat, plots = F)\n\n\n\n\n\n\n\n\n\nMVMR Results \n\n\nexposure\noutcome\nnsnp\nb\nse\npval\n\n\n\n\nLDL\nAD\n68\n0.27\n0.08\n8.7 × 10−4\n\n\nHDL\nAD\n76\n−0.12\n0.09\n0.201\n\n\n\n\n\n\n\n\n\nMVMR package\nThe MVMR R package can be used to perform multivariable Mendelian randomization analyses, which includes heterogeneity statistics to assess the strength and validity of the instruments. Additionally, it can evaluate conditional instrument strength and pleiotropic bias.\n\n\nFormat for MVMR\nmvmr_dat &lt;- cbind(mvdat$exposure_beta, \n        mvdat$exposure_se, \n        mvdat$outcome_beta, \n        mvdat$outcome_se\n      ) %&gt;%\n      as.data.frame() %&gt;%\n      rownames_to_column() %&gt;%\n      as.matrix()\n\nF.data &lt;- format_mvmr(BXGs = mvmr_dat[,c(2,3)],\n                    BYG = mvmr_dat[,6],\n                    seBXGs = mvmr_dat[,c(4,5)],\n                    seBYG = mvmr_dat[,7],\n                    RSID = mvmr_dat[,1])\n\n\n\n\nResults for MVMR\nres_mvmr &lt;- ivw_mvmr(r_input = F.data)\n\n\n\nMultivariable MR\n\n            Estimate Std. Error   t value    Pr(&gt;|t|)\nexposure1  0.2689424 0.08080841  3.328149 0.001135234\nexposure2 -0.1202465 0.09404536 -1.278601 0.203298214\n\nResidual standard error: 2.293 on 131 degrees of freedom\n\n\nResults for MVMR\nmvmr_out &lt;- res_mvmr %&gt;% \n    as.data.frame() %&gt;%\n    rownames_to_column() %&gt;%\n    as_tibble() %&gt;% \n    janitor::clean_names() %&gt;%\n    rename(exposure = rowname, b = estimate, se = std_error, p = pr_t) %&gt;%\n    mutate(\n      exposure = ifelse(exposure == 'exposure1', 'LDL', 'HDL'), \n      outcome = 'AD',\n      method = 'IVW-MVMR'\n    ) %&gt;%\n    relocate(outcome, method, .after = exposure)\n\n\n\n\n\n\n\n\n\nMVMR package Results \n\n\nexposure\noutcome\nmethod\nb\nse\nt_value\np\n\n\n\n\nLDL\nAD\nIVW-MVMR\n0.27\n0.08\n3.33\n0.001\n\n\nHDL\nAD\nIVW-MVMR\n−0.12\n0.09\n−1.28\n0.203\n\n\n\n\n\n\n\n\n\nMVMR Diagnostics\nsres &lt;- strength_mvmr(r_input = F.data, gencov = 0)\n\n\n\nConditional F-statistics for instrument strength\n\n            exposure1 exposure2\nF-statistic  77.75899  70.85811\n\n\nMVMR Diagnostics\npres &lt;- pleiotropy_mvmr(r_input = F.data, gencov = 0)\n\n\nQ-Statistic for instrument validity:\n681.9149 on 130 DF , p-value: 1.007841e-75\n\n\n\n\n\n\n\n\nNote\n\n\n\nCalculating heterogeneity statistics requires the covariance between the effect of the genetic variants on each exposure to be known. This can either be estimated from individual level data, be assumed to be zero, or fixed at zero using non-overlapping samples of each exposure GWAS.\nHere, Q- and F-statistics are estimated assuming a genetic covariance of 0. Phenotypic correlations can calcuated from summary statistics using PhenoSpD.\n\n\n\n\nRMVMR\nRadial MVMR is an extension of the MVMR package to perform radial multivariable Mendelian randomization analyses, including generating radial-MVMR plots to show the causal effect of each exposure on the outcome.\n\n\nResults for MVMR\nF.data_rmvmr &lt;- format_rmvmr(BXGs = mvmr_dat[,c(2,3)],\n                    BYG = mvmr_dat[,6],\n                    seBXGs = mvmr_dat[,c(4,5)],\n                    seBYG = mvmr_dat[,7],\n                    RSID = mvmr_dat[,1])\n\n\nres_rmvrm &lt;- ivw_rmvmr(F.data_rmvmr)\n\n\n\nRadial Multivariable MR\n\n            Estimate Std. Error   t value    Pr(&gt;|t|)\nexposure1  0.2689424 0.08080841  3.328149 0.001135234\nexposure2 -0.1202465 0.09404536 -1.278601 0.203298214\n\nResidual standard error: 2.293 on 131 degrees of freedom\n\n\nResults for MVMR\nsres_rmvrm &lt;- strength_rmvmr(F.data_rmvmr, gencov = 0)\n\n\n\n\nRMVMR Plot\nrmvrm_p &lt;- plot_rmvmr(F.data_rmvmr, res_rmvrm)\n\nrmvrm_p\n\n\n$p1\n\n\n\n\n\n\n$p2\n\n\n\n\n\n\nattr(,\"class\")\n[1] \"RMVMR_plot\"\n\n\n\n\nMendelianRandomization package\nThe MendelianRandomization package provides additional functions for MVMR versions of MR-Egger and Weighted Median Estimators.\n\n\nResults for MVMR Sensetivity analyses\nMRMVInputObject &lt;- MendelianRandomization::mr_mvinput(\n  bx = mvdat$exposure_beta, \n  bxse = mvdat$exposure_se,\n  by = mvdat$outcome_beta,\n  byse = mvdat$outcome_se,\n  snps = rownames(mvdat$exposure_beta), \n  exposure = c('LDL', 'HDL'), \n  outcome = 'AD'\n  )\n\nMRMV_ivw &lt;- MendelianRandomization::mr_mvivw(MRMVInputObject, \n                       model=\"default\", \n                       correl=FALSE, \n                       distribution=\"normal\",\n                       alpha = 0.05)\n\nMRMV_ivw_df &lt;- cbind(MRMV_ivw@Exposure, MRMV_ivw@Outcome, MRMV_ivw@Estimate, MRMV_ivw@StdError, MRMV_ivw@Pvalue) %&gt;%\n  as_tibble() %&gt;%\n  magrittr::set_colnames(c(\"Exposure\", \"Outcome\", \"b\", \"se\", \"p\")) %&gt;%\n  mutate(method = \"MRMV-IVW\")\n\nMRMV_egger &lt;- MendelianRandomization::mr_mvegger(MRMVInputObject, orientate = 1, correl = FALSE, distribution = \"normal\", alpha = 0.05)\n\nMRMV_egger_df &lt;- cbind(MRMV_egger@Exposure, MRMV_egger@Outcome, MRMV_egger@Estimate, MRMV_egger@StdError.Est, MRMV_egger@Pvalue.Est) %&gt;%\n  as_tibble() %&gt;%\n  magrittr::set_colnames(c(\"Exposure\", \"Outcome\", \"b\", \"se\", \"p\")) %&gt;%\n  mutate(method = \"MRMV-Egger\")\n\n\nMRMV_wme &lt;- MendelianRandomization::mr_mvmedian( MRMVInputObject, distribution = \"normal\", alpha = 0.05, iterations = 10000, seed = 314159265 )\n\nMRMV_wme_df &lt;- cbind(MRMV_wme@Exposure, MRMV_wme@Outcome, MRMV_wme@Estimate, MRMV_wme@StdError, MRMV_wme@Pvalue) %&gt;%\n  as_tibble() %&gt;%\n  magrittr::set_colnames(c(\"Exposure\", \"Outcome\", \"b\", \"se\", \"p\")) %&gt;%\n  mutate(method = \"MRMV-WME\")\n\n\n\n\n\n\n\n\n\nMVMR Sensetivity Results \n\n\nExposure\nOutcome\nmethod\nb\nse\np\n\n\n\n\nLDL\nAD\nMRMV-Egger\n0.43\n0.10\n9.8 × 10−6\n\n\nHDL\nAD\nMRMV-Egger\n−0.12\n0.09\n0.174\n\n\nLDL\nAD\nMRMV-WME\n0.04\n0.06\n0.544\n\n\nHDL\nAD\nMRMV-WME\n0.01\n0.06\n0.911\n\n\n\n\n\n\n\n\n\nMVMRmode Package\nThe MVMRmode pacakge implements a plurality valid sensitivity analysis for multivariable-MR.\n\n\n\n\n\n\nNote\n\n\n\nThis method and corresponding R package are very new, needs further testing.\n\n\n\n\nResults for MVMRmode\nMRMV_wbe_res &lt;- MVMRmode::mv_mrmode(Bout = mvdat$outcome_beta, \n                    Bexp = mvdat$exposure_beta, \n                    SEout = mvdat$outcome_se, \n                    SEexp = mvdat$exposure_se, \n                    Psi=0, CIMin = NA, CIMax = NA, CIStep = 0.001, alpha = 0.05, \n                    residual=\"IVW\",Mode=\"CM\",weighting = \"weighted\", stderror = \"simple\", \n                    phi = 1,distribution = \"normal\",iterations = 10000)\n\nMRMV_wbe_df &lt;- as_tibble(MRMV_wbe_res) %&gt;%\n  rename(b = Estimate, p = Pvalue) %&gt;%\n  mutate(Exposure = c(\"HDL\", \"LDL\"), \n         Outcome = \"AD\", \n         method = 'MRMV_WBE') %&gt;%\n  mutate_if(is.double, as.character)\n\n\n\n\n\n\n\n\n\nMVMR Sensetivity Results \n\n\nExposure\nOutcome\nmethod\nb\nCILower\nCIUpper\np\nNvalidSNPs\nNrange\n\n\n\n\nHDL\nAD\nMRMV_WBE\n−0.03\n−0.11\n0.05\n0.495\n117\n1\n\n\nLDL\nAD\nMRMV_WBE\n−0.07\n−0.16\n0.05\n0.151\n117\n1"
  },
  {
    "objectID": "scripts/mvmr.html#summary",
    "href": "scripts/mvmr.html#summary",
    "title": "7  Multivariable MR",
    "section": "Summary",
    "text": "Summary\nMultivariable MR allows estimation of causal relationships between multiple exposures and a single outcome. In univariable MR, we observed that HDL cholesterol levels are associated with a reduced risk of AD, while LDL cholesterol is associated with an increased risk. However, both exposures are highly correlated, and it is difficult to estimate the independent effects of HDL and LDL cholesterol on AD. Using MVMR, we found that after adjusting for the effects of LDL cholesterol, HDL cholesterol was no longer independently associated with AD. This suggests that the observed association between HDL cholesterol and AD risk in univariable MR analyses may be driven by the shared effects of LDL cholesterol.\n\n\n\n\n\n\n\n\n\nOutcome\nmethod\nLDL\nHDL\n\n\nb\nse\np\nb\nse\np\n\n\n\n\nAD\nMRMV-IVW\n0.27\n0.08\n8.7 × 10−4\n−0.12\n0.09\n0.201\n\n\nAD\nMRMV-Egger\n0.43\n0.10\n9.8 × 10−6\n−0.12\n0.09\n0.174\n\n\nAD\nMRMV-WME\n0.04\n0.06\n0.544\n0.01\n0.06\n0.911\n\n\nAD\nMRMV_WBE\n−0.07\nNA\n0.151\n−0.03\nNA\n0.495"
  },
  {
    "objectID": "scripts/lhc_mr.html#univariable-mr",
    "href": "scripts/lhc_mr.html#univariable-mr",
    "title": "8  LHC-MR",
    "section": "Univariable MR",
    "text": "Univariable MR\n[Introduction: insert text]\n\n\nUnivariable MR\n## Import harmonized data \nmr_dat &lt;- read_csv('data/harmonized_ldl_AD_data.csv') %&gt;%\n  mutate(\n    outcome = str_replace(outcome, '_stage123', ''), \n    # mr_keep = ifelse(gws.outcome == TRUE, TRUE, mr_keep)\n  )\n\n## MR \nmr_res &lt;- mr(mr_dat, method_list = c(\"mr_ivw_fe\", \"mr_egger_regression\", \"mr_weighted_median\", \"mr_weighted_mode\")) %&gt;% \n  as_tibble()\n\n## Single SNP analysis\nres_single &lt;- mr_singlesnp(mr_dat, all_method = c(\"mr_ivw_fe\", \"mr_egger_regression\", \"mr_weighted_median\", \"mr_weighted_mode\")) %&gt;% as_tibble()\n\n## Egger intercept for pleitropy \nres_pleio &lt;- mr_pleiotropy_test(mr_dat)\n\n## Cochrans Q for heterogeneity \nres_het &lt;- mr_heterogeneity(mr_dat, method_list = c(\"mr_egger_regression\", \"mr_ivw\"))\n\n# Radial MR \n# radial_dat &lt;- mr_dat %&gt;% filter(mr_keep == T) %&gt;% dat_to_RadialMR()\n# radial_res &lt;- map(radial_dat, function(x){\n#     ivw_radial(x, alpha = 0.05/nrow(x))\n#   }\n# )\n\n\n[insert text]\n\n\n\n\n\n\n  \n    \n    \n      \n      method\n      nsnp\n      b\n      se\n      pval\n    \n  \n  \n    \n      Willer2013ldl\n    \n    Bellenguez2022load\nIVW\n66\n−0.06\n0.02\n0.003\n    Bellenguez2022load\nMR Egger\n66\n−0.11\n0.06\n0.062\n    Bellenguez2022load\nWeighted median\n66\n−0.08\n0.03\n0.027\n    Bellenguez2022load\nWeighted mode\n66\n−0.07\n0.03\n0.025\n    Kunkle2019load\nIVW\n66\n−0.03\n0.04\n0.525\n    Kunkle2019load\nMR Egger\n66\n0.01\n0.09\n0.956\n    Kunkle2019load\nWeighted median\n66\n0.04\n0.06\n0.535\n    Kunkle2019load\nWeighted mode\n66\n0.01\n0.06\n0.898\n    \n      Graham2021ldl\n    \n    Bellenguez2022load\nIVW\n349\n−0.08\n0.02\n9.7 × 10−4\n    Bellenguez2022load\nMR Egger\n349\n−0.10\n0.05\n0.046\n    Bellenguez2022load\nWeighted median\n349\n−0.08\n0.04\n0.035\n    Bellenguez2022load\nWeighted mode\n349\n−0.07\n0.05\n0.180\n    Kunkle2019load\nIVW\n349\n0.00\n0.04\n0.941\n    Kunkle2019load\nMR Egger\n349\n0.00\n0.08\n0.992\n    Kunkle2019load\nWeighted median\n349\n0.02\n0.07\n0.783\n    Kunkle2019load\nWeighted mode\n349\n−0.05\n0.09\n0.591\n  \n  \n  \n\n\n\n\n\n\nUnivariable MR Plots\n## Plots\nscatter_p &lt;- mr_scatter_plot(mr_res, mr_dat) %&gt;%\n  map(., function(scater_plot){\n  scater_plot + theme_bw() + \n    theme(\n      legend.position = 'none', \n      text = element_text(size = 8), \n    )\n  })\n\nfunnel_p &lt;- mr_funnel_plot(res_single) %&gt;%\n  map(., function(funnel_plot){\n  funnel_plot + theme_bw() + \n    theme(\n      legend.position = 'none', \n      text = element_text(size = 8), \n    )\n  })\n\nmr_legend &lt;- cowplot::get_legend(\n  mr_scatter_plot(mr_res, mr_dat)[[1]] + theme_bw() + \n    guides(colour = guide_legend(nrow = 1)) + \n    theme(\n      text = element_text(size = 8), \n    )\n)\n\njoint_mr_p &lt;- cowplot::plot_grid(\n  plotlist=c(scatter_p, funnel_p), \n  ncol = 2, byrow = FALSE, \n  align = 'hv'\n  )\n\nmr_p_out &lt;- cowplot::plot_grid(\n  joint_mr_p, mr_legend,\n  ncol = 1, \n  rel_heights = c(1, 0.1)\n  )\n\n\nmr_p_out\n\n\n\n\n\nUnivariable MR Plots\nggsave(\"results/plots/mr_ldl_ad_all.png\", units = \"in\", height = 6, width = 4)\n\n# Radial MR \n# radial_p &lt;-  map(radial_res, function(x){\n#      plot_radial(x, radial_scale = F, show_outliers = F)\n#   }\n# )\n\n\n[Pleiotropy: insert text]\n\n\n\n\n\n\n  \n    \n    \n      \n      egger_intercept\n      se\n      pval\n    \n  \n  \n    \n      Willer2013ldl\n    \n    Bellenguez2022load\n0.00\n0.00\n0.321\n    Kunkle2019load\n0.00\n0.01\n0.688\n    \n      Graham2021ldl\n    \n    Bellenguez2022load\n0.00\n0.00\n0.487\n    Kunkle2019load\n0.00\n0.00\n0.952\n  \n  \n  \n\n\n\n\n[Heterogeneity: insert text]\n\n\nHeterogeneity\n# Heterogeneity statistics \nres_het &lt;- mr_heterogeneity(mr_dat, method_list = c(\"mr_egger_regression\", \"mr_ivw\"))\n\nres_het %&gt;%\n  select(-id.exposure, -id.outcome, -outcome, -exposure) %&gt;%\n  gt() %&gt;%\n  fmt_number(\n    columns = Q\n  ) %&gt;%\n  fmt_number(\n    columns = Q_pval,\n    rows = Q_pval &gt; 0.001,\n    decimals = 3\n  ) %&gt;% \n  fmt_scientific(\n    columns = Q_pval,\n    rows = Q_pval &lt;= 0.001,\n    decimals = 1\n  )\n\n\n\n\n\n\n  \n    \n    \n      method\n      Q\n      Q_df\n      Q_pval\n    \n  \n  \n    MR Egger\n163.37\n64\n1.2 × 10−10\n    Inverse variance weighted\n165.92\n65\n9.0 × 10−11\n    MR Egger\n111.96\n64\n2.0 × 10−4\n    Inverse variance weighted\n112.25\n65\n2.5 × 10−4\n    MR Egger\n683.04\n347\n3.5 × 10−24\n    Inverse variance weighted\n684.00\n348\n3.9 × 10−24\n    MR Egger\n487.97\n347\n8.5 × 10−7\n    Inverse variance weighted\n487.97\n348\n1.0 × 10−6"
  },
  {
    "objectID": "scripts/lhc_mr.html#importing-data",
    "href": "scripts/lhc_mr.html#importing-data",
    "title": "8  LHC-MR",
    "section": "Importing Data",
    "text": "Importing Data\n\n\nLD Paths\n## File paths needed for the analysis\nLD.filepath = \"resources/LDscores_filtered.csv\" # LD scores\nrho.filepath = \"resources/LD_GM2_2prm.csv\" # local/SNP-specfic LD scores\n\nld = \"resources/eur_w_ld_chr/\"\nhm3 = \"resources/w_hm3.snplist\"\n\n\n\n\nImport GWAS SumStats\npaths = c(\n  \"resources/Graham2021ldl.chrall.CPRA_b37.tsv.gz\",\n  \"resources/Willer2013ldl.chrall.CPRA_b37.tsv.gz\", \n  \"resources/Kunkle2019load_stage123.chrall.CPRA_b37.tsv.gz\", \n  \"resources/Bellenguez2022load.chrall.CPRA_b37.tsv.gz\"\n)\nphenotypes &lt;- str_extract(paths, \"(?&lt;=/).*(?=.chrall)\")\n\nss &lt;- map(paths, function(x){\n  trait &lt;- str_extract(x, \"(?&lt;=/).*(?=.chrall)\")\n  \n  message(\"Imporing: \", x, \"....\")\n  ## Filter out problematic snps - MAF &lt; 1%, MNVs, rsid, APOE region\n  ss &lt;- read_tsv(\n    x, comment = \"##\", col_types = coltypes, # n_max = 100,\n    col_select = c(DBSNP_ID, CHROM, POS, REF, ALT, AF, BETA, SE, Z, P, N, TRAIT))  %&gt;%\n    filter(between(AF, 0.01, 0.99)) %&gt;%\n    filter(nchar(REF) == 1 & nchar(ALT) == 1) %&gt;%\n    filter(!is.na(DBSNP_ID)) %&gt;%\n    filter(!(CHROM == 19 & between(POS, 44912079, 45912079))) %&gt;%\n    mutate(TRAIT = trait) %&gt;%\n    rename(SNP = DBSNP_ID) \n  \n  }) %&gt;%\n  magrittr::set_names(phenotypes)"
  },
  {
    "objectID": "scripts/lhc_mr.html#graham-ldl---bellenguez-ad",
    "href": "scripts/lhc_mr.html#graham-ldl---bellenguez-ad",
    "title": "8  LHC-MR",
    "section": "Graham LDL - Bellenguez AD",
    "text": "Graham LDL - Bellenguez AD\nLHC-MR takes a long time to run, this analysis took 1.6 days.\n\n\nMerge Graham2021ldl & Bellenguez2022load\n## Step 1 - Merge Data \ntraits.Graham_Bellenguez = c(\"Graham2021ldl\",\"Bellenguez2022load\")\ninput.Graham_Bellenguez = list(ss$Graham2021ldl, ss$Bellenguez2022load)\ndf.Graham_Bellenguez = merge_sumstats(\n  input.Graham_Bellenguez, traits.Graham_Bellenguez, LD.filepath, rho.filepath\n  )\n\n## Step 2: Calculating smart starting points for the likelihood optimisation\nSP_list.Graham_Bellenguez = calculate_SP(\n  df.Graham_Bellenguez, traits.Graham_Bellenguez, \n  run_ldsc=TRUE, run_MR=TRUE, \n  hm3=hm3, ld=ld,\n  nStep = 2, SP_single=3, SP_pair=50, SNP_filter=10\n  )\n\n## Step 3: Running the likelihood optimisation to estimate the parameters, followed by a block-jackknife procedure to calculate parameter-SE\nres = lhc_mr(SP_list.Graham_Bellenguez, traits.Graham_Bellenguez, \n             paral_method=\"lapply\", nCores = 1, nBlock=200)\n\n## Step 4: move results\n\nGraham2021ldl_Bellenguez2022load_dir = \"data/lhcmr/Graham2021ldl_Bellenguez2022load\"\nif (!dir.exists(Graham2021ldl_Bellenguez2022load_dir)){\n  dir.create(Graham2021ldl_Bellenguez2022load_dir)\n}else{\n  print(\"dir exists\")\n}\n\nlhcmr_output &lt;- list.files()\nGraham2021ldl_Bellenguez2022load_files &lt;- lhcmr_output[\n  str_detect(lhcmr_output, \"200blockJK|munge.log|FullRes|munging.log|MRresults.csv|ldsc.log|SingleTraitAnalysis|StartingPoints|SummarisedResults\")\n]\n\nfile.copy(from = Graham2021ldl_Bellenguez2022load_files,\n          to   = glue(\"{Graham2021ldl_Bellenguez2022load_dir}/{Graham2021ldl_Bellenguez2022load_files}\"))\nfile.remove(Graham2021ldl_Bellenguez2022load_files)"
  },
  {
    "objectID": "scripts/lhc_mr.html#graham-ldl---kunkle-ad",
    "href": "scripts/lhc_mr.html#graham-ldl---kunkle-ad",
    "title": "8  LHC-MR",
    "section": "Graham LDL - Kunkle AD",
    "text": "Graham LDL - Kunkle AD\n\n\nMerge Graham2021ldl & Kunkle2019load_stage123\n## Step 1 - Merge Data \ntraits.Graham_Kunkle = c(\"Graham2021ldl\",\"Kunkle2019load\")\ninput.Graham_Kunkle = list(ss$Graham2021ldl, ss$Kunkle2019load_stage123)\ndf.Graham_Kunkle = merge_sumstats(\n  input.Graham_Kunkle, traits.Graham_Kunkle, LD.filepath, rho.filepath\n  )\n\n## Step 2: Calculating smart starting points for the likelihood optimisation\nSP_list.Graham_Kunkle = calculate_SP(\n  df.Graham_Kunkle, traits.Graham_Kunkle, \n  run_ldsc=TRUE, run_MR=TRUE, \n  hm3=hm3, ld=ld,\n  nStep = 2, SP_single=3, SP_pair=50, SNP_filter=10\n  )\n\n## Step 3: Running the likelihood optimisation to estimate the parameters, followed by a block-jackknife procedure to calculate parameter-SE\nres.Graham_Kunkle = lhc_mr(SP_list.Graham_Kunkle, traits.Graham_Kunkle, \n             paral_method=\"lapply\", nCores = 1, nBlock=200)\n\n## Step 4: move results\n\nGraham2021ldl_Kunkle2019load_dir = \"data/lhcmr/Graham2021ldl_Kunkle2019load\"\nif (!dir.exists(Graham2021ldl_Kunkle2019load_dir)){\n  dir.create(Graham2021ldl_Kunkle2019load_dir)\n}else{\n  print(\"dir exists\")\n}\n\nlhcmr_output &lt;- list.files()\nGraham2021ldl_Kunkle2019load_files &lt;- lhcmr_output[\n  str_detect(lhcmr_output, \"200blockJK|munge.log|FullRes|munging.log|MRresults.csv|ldsc.log|SingleTraitAnalysis|StartingPoints|SummarisedResults\")\n]\n\nfile.copy(from = Graham2021ldl_Kunkle2019load_files,\n          to   = glue(\"{Graham2021ldl_Kunkle2019load_dir}/{Graham2021ldl_Kunkle2019load_files}\"))\nfile.remove(Graham2021ldl_Kunkle2019load_files)"
  },
  {
    "objectID": "scripts/lhc_mr.html#willer-ldl---bellenguez-ad",
    "href": "scripts/lhc_mr.html#willer-ldl---bellenguez-ad",
    "title": "8  LHC-MR",
    "section": "Willer LDL - Bellenguez AD",
    "text": "Willer LDL - Bellenguez AD\nLHC-MR takes a long time to run, this analysis took 1.6 days.\n\n\nMerge Graham2021ldl & Bellenguez2022load\n## Step 1 - Merge Data \ntraits.Willer_Bellenguez = c(\"Willer2013ldl\",\"Bellenguez2022load\")\ninput.Willer_Bellenguez = list(ss$Willer2013ldl, ss$Bellenguez2022load)\ndf.Willer_Bellenguez = merge_sumstats(\n  input.Willer_Bellenguez, traits.Willer_Bellenguez, LD.filepath, rho.filepath\n  )\n\n## Step 2: Calculating smart starting points for the likelihood optimisation\nSP_list.Willer_Bellenguez = calculate_SP(\n  df.Willer_Bellenguez, traits.Willer_Bellenguez, \n  run_ldsc=TRUE, run_MR=TRUE, \n  hm3=hm3, ld=ld,\n  nStep = 2, SP_single=3, SP_pair=50, SNP_filter=10\n  )\n\n## Step 3: Running the likelihood optimisation to estimate the parameters, followed by a block-jackknife procedure to calculate parameter-SE\nres.Willer_Bellenguez = lhc_mr(SP_list.Willer_Bellenguez, traits.Willer_Bellenguez, \n             paral_method=\"lapply\", nCores = 2, nBlock=200)\n\n## Step 4: move results\n\nWiller2013ldl_Bellenguez2022load_dir = \"data/lhcmr/Willer2013ldl_Bellenguez2022load\"\nif (!dir.exists(Willer2013ldl_Bellenguez2022load_dir)){\n  dir.create(Willer2013ldl_Bellenguez2022load_dir)\n}else{\n  print(\"dir exists\")\n}\n\nlhcmr_output &lt;- list.files()\nWiller2013ldl_Bellenguez2022load_files &lt;- lhcmr_output[\n  str_detect(lhcmr_output, \"200blockJK|munge.log|FullRes|munging.log|MRresults.csv|ldsc.log|SingleTraitAnalysis|StartingPoints|SummarisedResults\")\n]\n\nfile.copy(from = Willer2013ldl_Bellenguez2022load_files,\n          to   = glue(\"{Willer2013ldl_Bellenguez2022load_dir}/{Willer2013ldl_Bellenguez2022load_files}\"))\nfile.remove(Willer2013ldl_Bellenguez2022load_files)"
  },
  {
    "objectID": "scripts/lhc_mr.html#willer-ldl---kunkle-ad",
    "href": "scripts/lhc_mr.html#willer-ldl---kunkle-ad",
    "title": "8  LHC-MR",
    "section": "Willer LDL - Kunkle AD",
    "text": "Willer LDL - Kunkle AD\n\n\nMerge Willer & Kunkle2019load_stage123\n## Step 1 - Merge Data \ntraits.Willer_Kunkle = c(\"Willer2013ldl\",\"Kunkle2019load\")\ninput.Willer_Kunkle = list(ss$Willer2013ldl, ss$Kunkle2019load_stage123)\ndf.Willer_Kunkle = merge_sumstats(\n  input.Willer_Kunkle, traits.Willer_Kunkle, LD.filepath, rho.filepath\n  )\n\n## Step 2: Calculating smart starting points for the likelihood optimisation\nSP_list.Willer_Kunkle = calculate_SP(\n  df.Willer_Kunkle, traits.Willer_Kunkle, \n  run_ldsc=TRUE, run_MR=TRUE, \n  hm3=hm3, ld=ld,\n  nStep = 2, SP_single=3, SP_pair=50, SNP_filter=10\n  )\n\n## Step 3: Running the likelihood optimisation to estimate the parameters, followed by a block-jackknife procedure to calculate parameter-SE\nres.Willer_Kunkle = lhc_mr(SP_list.Willer_Kunkle, traits.Willer_Kunkle, \n             paral_method=\"lapply\", nCores = 2, nBlock=200)\n\n## Step 4: move results\n\nWiller2013ldl_Kunkle2019load_dir = \"data/lhcmr/Willer2013ldl_Kunkle2019load\"\nif (!dir.exists(Willer2013ldl_Kunkle2019load_dir)){\n  dir.create(Willer2013ldl_Kunkle2019load_dir)\n}else{\n  print(\"dir exists\")\n}\n\nlhcmr_output &lt;- list.files()\nWiller2013ldl_Kunkle2019load_files &lt;- lhcmr_output[\n  str_detect(lhcmr_output, \"200blockJK|munge.log|FullRes|munging.log|MRresults.csv|ldsc.log|SingleTraitAnalysis|StartingPoints|SummarisedResults\")\n]\n\nfile.copy(from = Willer2013ldl_Kunkle2019load_files,\n          to   = glue(\"{Willer2013ldl_Kunkle2019load_dir}/{Willer2013ldl_Kunkle2019load_files}\"))\nfile.remove(Willer2013ldl_Kunkle2019load_files)"
  },
  {
    "objectID": "scripts/other_methods.html",
    "href": "scripts/other_methods.html",
    "title": "Other Methods",
    "section": "",
    "text": "Mendelian randomization analyses can be complemented by other statistical genetic analyses."
  },
  {
    "objectID": "scripts/genetic_correlations.html#methods",
    "href": "scripts/genetic_correlations.html#methods",
    "title": "9  Genetic Correlations",
    "section": "Methods",
    "text": "Methods\n\nTools & Publications\nR, GenomicSEM, LDSC, HDL\n\nBulik-Sullivan, B. et al. An atlas of genetic correlations across human diseases and traits. Nat Genet 47, 1236–1241 (2015).\nNing, Z., Pawitan, Y. & Shen, X. High-definition likelihood inference of genetic correlations across human complex traits. Nat Genet 52, 859–864 (2020).\n\nGenetic correlation (rg) refers to the degree to which the genetic determinants of two traits overlap - the proportion of variance that two traits share due to genetic causes. A positive genetic correlation between two traits implies that the same genetic variants are influencing both traits in the same direction. Conversely, a negative genetic correlation implies that the genetic variants influencing one trait are having the opposite effect on the other trait.\nLDSC: Linkage disequilibrium score regression (LDSC) leverages linkage disequilibrium (LD), the non-random association of alleles at different loci, to estimate genetic correlations between two traits. This method operates on the premise that single nucleotide polymorphisms (SNPs) with a higher count of LD partners (thus having a higher LD score) are typically more associated with a trait due to polygenicity, a condition where numerous genetic variants each exert a minor effect.\nHDL: High-definition likelihood (HDL) provides genetic correlation estimates that have higher accuracy and precision compared to LDSC. HDL achives this by using a full likelihood-based method that leverages LD information across the whole genome, where as LDSC only use partial information.\n\n\nMunge GWAS SumStats\n## Summary statistics \nWiller2013ldl = \"resources/Willer2013ldl.chrall.CPRA_b37.tsv.gz\"\nGraham2021ldl = \"resources/Graham2021ldl.chrall.CPRA_b37.tsv.gz\"\nKunkleAD = \"resources/Kunkle2019load_stage123.chrall.CPRA_b37.tsv.gz\"\nBellenguezAD = \"resources/Bellenguez2022load.chrall.CPRA_b37.tsv.gz\"\n\n## LD Structure \nld_path = \"resources/eur_w_ld_chr/\"\n\n## HAPMAP3 SNPs\nhm3_path = \"resources/w_hm3.snplist\"\n\n\nGenomicSEM::munge(\n  files = c(Willer2013ldl, Graham2021ldl, KunkleAD, BellenguezAD), \n  hm3 = hm3_path, \n  trait.names = c(\"Willer2013ldl\", \"Graham2021ldl\", \"KunkleAD\", \"BellenguezAD\"), \n  maf.filter = 0.05, \n  column.names = list(\n    SNP='DBSNP_ID', \n    MAF='AF', \n    A1='ALT',\n    A2='REF', \n    effect='BETA', \n    N = \"N\"\n  ), \n  overwrite=FALSE\n)\n\n\n\n\nLDSC\nldsc.covstruct &lt;- GenomicSEM::ldsc(\n     traits = c(\"Willer2013ldl.sumstats.gz\", \"Graham2021ldl.sumstats.gz\", \"BellenguezAD.sumstats.gz\", \"KunkleAD.sumstats.gz\"),\n     trait.names = c(\"Willer2013ldl\", \"Graham2021ldl\", \"BellenguezAD\", \"KunkleAD\"), \n     sample.prev = c(NA, NA, 0.18, 0.37),\n     population.prev = c(NA, NA, 0.31, 0.31),\n     ld = ld_path, \n     wld = ld_path,\n     stand = TRUE\n     )\n\n\n\n\nHDL\nhdl.covstruct &lt;- GenomicSEM::hdl(\n     traits = c(\"Willer2013ldl.sumstats.gz\", \"Graham2021ldl.sumstats.gz\", \"BellenguezAD.sumstats.gz\", \"KunkleAD.sumstats.gz\"),\n     trait.names = c(\"Willer2013ldl\", \"Graham2021ldl\", \"BellenguezAD\", \"KunkleAD\"), \n     sample.prev = c(NA, NA, 0.18, 0.37),\n     population.prev = c(NA, NA, 0.31, 0.31),\n     LD.path=\"resources/UKB_imputed_hapmap2_SVD_eigen99_extraction/\", \n     method = \"piecewise\"\n     )"
  }
]