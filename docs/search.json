[
  {
    "objectID": "index.html",
    "href": "index.html",
    "title": "Mendelian Randomization Tutorial",
    "section": "",
    "text": "Preface\nMendelian randomization (MR) is a method used to infer causality between and exposure and outcome using genetic variants as instrumental variables. It is based on the idea that genetic variants, which are inherited randomly and not influenced by environmental factors or reverse causation, can be used to estimate the causal effect of an exposure on an outcome.\nThese resources aim to provide a starting point for understanding the basic concepts and methods of MR, as well as the current best practices and software tools available for conducting MR studies."
  },
  {
    "objectID": "scripts/intro.html#sugested-readings",
    "href": "scripts/intro.html#sugested-readings",
    "title": "Introduction",
    "section": "Sugested Readings",
    "text": "Sugested Readings\nThese resources provide a good starting point for understanding the basic concepts and methods of MR, as well as the current best practices and software tools available for conducting MR studies.\n\nGenome-wide association studies\n\nUffelmann, E. et al. Genome-wide association studies. Nat Rev Methods Primers 1, 59 (2021).\nMarees, A. T. et al. A tutorial on conducting genome‐wide association studies: Quality control and statistical analysis. Int J Method Psych 27, e1608 (2018).\nMacArthur, J. A. L. et al. Workshop proceedings: GWAS summary statistics standards and sharing. Cell Genom 1, 100004 (2021).\n\n\n\nMendelian Randomization\n\nSanderson, E. et al. Mendelian randomization. Nat Rev Methods Primers 2, 6 (2022).\nDavies, N. M., Holmes, M. V. & Smith, G. D. Reading Mendelian randomisation studies: a guide, glossary, and checklist for clinicians. Bmj 362, k601 (2017).\nHemani, G. et al. The MR-Base platform supports systematic causal inference across the human phenome. Elife 7, e34408 (2018).\nSkrivankova, V. W. et al. Strengthening the Reporting of Observational Studies in Epidemiology Using Mendelian Randomization. Jama 326, 1614–1621 (2021).\nSkrivankova, V. W. et al. Strengthening the reporting of observational studies in epidemiology using mendelian randomisation (STROBE-MR): explanation and elaboration. Bmj 375, n2233 (2021).\n\n\n\nMultivariable Mendelian Randomization\n\nSanderson, E. Multivariable Mendelian Randomization and Mediation. Csh Perspect Med 11, a038984 (2020).\nCarter, A. R. et al. Mendelian randomisation for mediation analysis: current methods and challenges for implementation. Eur J Epidemiol 36, 465–478 (2021).\n\n\n\nR packages, tutorials, and databases\n\nGWAS Catalog: A database of genome-wide association studies and loci-trait associsation discovered.\nPhenoScanner: A database of human genotype-phenotype associations.\nMungeSumstats: Tutorial for standardizing GWAS summary statistics using the MungeSumstats R package.\nTwoSampleMR: Tutorial for conducting Two-Sample Mendelian randomization using the TwoSampleMR R package\nMVMR: Tutorial for conducting multivariable Mendelian ranomization using the MVMR R package.\nMendelianRandomization: Vignette for the MendelianRandomization R package.\n\nMR Dictionary: The definitive list of terms for Mendelian randomization research"
  },
  {
    "objectID": "scripts/phenotypes.html#lipids",
    "href": "scripts/phenotypes.html#lipids",
    "title": "1  Phenotypes",
    "section": "Lipids",
    "text": "Lipids\nA GWAS of low-density lipoprotein (LDL) cholesterol, high-density lipoprotein (HDL) cholesterol, triglycerides and total cholesterol levels conducted in 188,577 individuals that identified 157 loci were associated with lipid levels.\nWiller, C. J. et al. Discovery and refinement of loci associated with lipid levels. Nat Genet 45, 1274–83 (2013).\nSummary statistics\n\nLDL Cholesterol\nHDL Cholesterol\nTriglycerides\nTotal cholesterol\n\n\n\nTotal Cholesterol Manhattan\ntc_path = \"resources/Willer2013tc.chrall.CPRA_b37.tsv.gz\"\ntc_ss <- read_tsv(tc_path, comment = \"##\", col_types = coltypes, \n                        col_select = c(DBSNP_ID, CHROM, POS, REF, ALT, AF, BETA, SE, Z, P, N, TRAIT))\n\n# Filter on p < 0.5 to reduce compute\nggman(filter(tc_ss, P < 0.05 & P > 1e-100), snp = \"DBSNP_ID\", bp = \"POS\", chrom = \"CHROM\", pvalue = \"P\", relative.positions = TRUE) + \n  theme_classic()"
  },
  {
    "objectID": "scripts/phenotypes.html#alzheimers-disease",
    "href": "scripts/phenotypes.html#alzheimers-disease",
    "title": "1  Phenotypes",
    "section": "Alzheimer’s disease",
    "text": "Alzheimer’s disease\nA GWAS of Alzheimer’s disease conducted in 94,437 indivudles by the International Genomics Alzheiemr’s Project that Identified 20 genome-wide signiﬁcant loci.\nKunkle, B. W. et al. Genetic meta-analysis of diagnosed Alzheimer’s disease identifies new risk loci and implicates Aβ, tau, immunity and lipid processing. Nat Genet 51, 414–430 (2019).\nSummary statistics\n\nLate-onset Alzheimer’s disease\n\n\n\nAD Manhattan Plot\nAD_path = \"resources/Kunkle2019load_stage123.chrall.CPRA_b37.tsv.gz\"\nAD_ss <- read_tsv(AD_path, comment = \"##\",  col_types = coltypes, \n                       col_select = c(DBSNP_ID, CHROM, POS, REF, ALT, AF, BETA, SE, Z, P, N, TRAIT))\n\n# Filter on p < 0.5 to reduce compute\nggman(filter(AD_ss, P < 0.05 & P > 1e-100), snp = \"DBSNP_ID\", bp = \"POS\", chrom = \"CHROM\", pvalue = \"P\", relative.positions = TRUE) + \n  theme_classic()"
  },
  {
    "objectID": "scripts/phenotypes.html#sumstat-standardization",
    "href": "scripts/phenotypes.html#sumstat-standardization",
    "title": "1  Phenotypes",
    "section": "SumStat Standardization",
    "text": "SumStat Standardization\nGWAS summary statistics were standardized using a Snakemake Workflow that (1) aligns effect alleles to the alternate allele on the forward strand of the human genome reference build and normalizes indels, (2) annotates variants with marker names using chromosome:position:ref:alt, 1000 Genomes rsIDs (phase III), and database-single-nucleotide polymorphism (dbSNP) rsIDs (b151) (3) where allele frequencies are missing, annotates allele frequencies using non-Finnish Europeans from gnomAD (version 2.1), and (4) convert summary statistics to VCF and TSV ﬁles.\nAndrews, S. J. et al. Causal Associations Between Modifiable Risk Factors and the Alzheimer’s Phenome. Ann Neurol 89, 54–65 (2021)."
  },
  {
    "objectID": "scripts/sumstats.html",
    "href": "scripts/sumstats.html",
    "title": "2  Standardizing and harmonizing GWAS SumStats",
    "section": "",
    "text": "Two-sample MR methods require the use of summary statistics from genome-wide association studies, including single nucleotide polymorphisms (SNPs), beta coefficients, standard errors, p-values, and allele frequencies. However, the historical lack of standards for data content and file formats in GWAS summary statistics has resulted in heterogeneous data sets. To address this issue, standardizing and harmonizing the GWAS summary statistics is crucial before conducting MR analyses. The GWAS Catalog and OpenGWAS platforms have developed formats such as GWAS-SSF (Hayhurst et al. 2022) and GWAS-VCF (Lyon et al. 2021) to facilitate sharing of GWAS SumStats. Tools like MungeSumstats (Murphy et al 2021) and GWAS2VCF (Lyon et al. 2021) are available that provide rapid standardization and quality control of GWAS SumStats."
  },
  {
    "objectID": "scripts/methods.html",
    "href": "scripts/methods.html",
    "title": "Methods",
    "section": "",
    "text": "An overview of different Mendelian randomization methods for evaluating the causal effect of an exposure on an outcome."
  },
  {
    "objectID": "scripts/mr_harmonization.html#exposure-dataset",
    "href": "scripts/mr_harmonization.html#exposure-dataset",
    "title": "3  Harmonizing SumStats",
    "section": "Exposure dataset",
    "text": "Exposure dataset\nThe exposure GWAS SumStats have previously been standardized to common format, however, they need to be converted to the format required by TwoSampleMR.\n\n\nImport exposure GWAS SumStats\nexposure_path = \"resources/Willer2013tc.chrall.CPRA_b37.tsv.gz\"\nexposure_ss <- read_tsv(exposure_path, comment = \"##\", col_types = coltypes, \n                        col_select = c(DBSNP_ID, CHROM, POS, REF, ALT, AF, BETA, SE, Z, P, N, TRAIT))\n\n# Format data to TwoSampleMR format\nexposure <- exposure_ss %>%\n  format_data(.,\n    type = \"exposure\",\n    snps = NULL,\n    header = TRUE,\n    phenotype_col = \"TRAIT\",\n    snp_col = \"DBSNP_ID\",\n    beta_col = \"BETA\",\n    se_col = \"SE\",\n    eaf_col = \"AF\",\n    effect_allele_col = \"ALT\",\n    other_allele_col = \"REF\",\n    pval_col = \"P\",\n    samplesize_col = \"N\",\n    z_col = \"Z\",\n    chr_col = \"CHROM\",\n    pos_col = \"POS\",\n    log_pval = FALSE\n) %>%\n  as_tibble()\n\n\nTwo-Sample MR methods usually utilize only independent genome-wide significant SNPs. The process of extracting these SNPs from the full genome-wide association study (GWAS) summary statistics involves linkage disequilibrium (LD) clumping. TwoSampleMR provides a clumping function, TwoSampleMR::clump_data(), which performs a stringent clumping procedure with a default window size of 10Mb and an r2 threshold of 0.001. Setting clump_p1 = 1 and clump_p2 = 1 will perform clumping on all available SNPs. The GWAS summary statistics used in this analysis are from a population of European ancestry, and therefore the EUR reference panel is specified.\n\n\nLD clump exposure\n# Perform LD clumping on SNP data, filter SNPs to make it run faster\nexposure_clump <- exposure %>% \n  filter(pval.exposure < 0.01) %>%\n  clump_data(.,\n  clump_kb = 10000,\n  clump_r2 = 0.001,\n  clump_p1 = 1,\n  clump_p2 = 1,\n  pop = \"EUR\"\n)\n\n# Should filter here at GWS, I dont here to demonstrate proxy snps\n# exposure_dat <- filter(exposure_clump, pval.exposure < 5e-8)\nexposure_dat <- exposure_clump\n\n\n\n\n\n\n\n\nNote\n\n\n\nTypically, in a Two-Sample MR analysis, one would only consider genome-wide significant SNPs (SNPs with pval.exposure < 5e-8). However, in this demonstration, all independent SNPs with pval.exposure < 0.01 are retained to showcase how to identify proxy variants, as all of the genome-wide significant SNPs are also present in the outcome GWAS."
  },
  {
    "objectID": "scripts/mr_harmonization.html#outcome-datasets",
    "href": "scripts/mr_harmonization.html#outcome-datasets",
    "title": "3  Harmonizing SumStats",
    "section": "Outcome datasets",
    "text": "Outcome datasets\nSimilarly, the outcome dataset needs to be converted to the TwoSampleMR format.\n\n\nImport outcome GWAS SumStats\noutcome_path = \"resources/Kunkle2019load_stage123.chrall.CPRA_b37.tsv.gz\"\noutcome_ss <- read_tsv(outcome_path, comment = \"##\",  col_types = coltypes, \n                       col_select = c(DBSNP_ID, CHROM, POS, REF, ALT, AF, BETA, SE, Z, P, N, TRAIT))\n\n# Format outcome\noutcome <- outcome_ss %>%\n  format_data(.,\n    type = \"outcome\",\n    snps = NULL,\n    header = TRUE,\n    phenotype_col = \"TRAIT\",\n    snp_col = \"DBSNP_ID\",\n    beta_col = \"BETA\",\n    se_col = \"SE\",\n    eaf_col = \"AF\",\n    effect_allele_col = \"ALT\",\n    other_allele_col = \"REF\",\n    pval_col = \"P\",\n    samplesize_col = \"N\",\n    z_col = \"Z\",\n    chr_col = \"CHROM\",\n    pos_col = \"POS\",\n    log_pval = FALSE\n) %>%\n  as_tibble()\n\n\n\nLD Proxy SNPs\nProxy variants are genetic markers that are in strong linkage disequilibrium (LD) with the variants of interest, and can be used as a proxy to estimate the effect of the variants of interest on the outcome of interest. In some cases, variants in the exposure dataset may not be present in the outcome dataset due to different GWAS using different genotyping arrays, impuation methods, and QC practices. To overcome this, proxy variants in the outcome dataset can be substituted for the missing variant.\nHere we first extract our exposure SNPs from the outcome GWAS and determine which SNPs are not presenting in the outcome dataset. We then query the LDLink web server to identify proxy variants that are in strong LD (r2) with the missing variant. The resulting proxy SNPs are then extracted from the outcome dataset and appended to the initial SNPs extracted from the outcome GWAS using munge_proxies() function.\n\n\nIdentify Proxy Variants\n# extract exposure SNPs present in outcome\noutcome_clump <- semi_join(\n  outcome, exposure_dat, by = \"SNP\"\n)\n\n# Exposure SNPs not present in outomce\nexp_snps_wo <- anti_join(\n  exposure_dat, outcome, by = \"SNP\"\n)\n\n# Use LDLinkR to identify proxy snps\nLDproxy_batch(exp_snps_wo$SNP, \n        pop = \"CEU\",             # Match population ancestries\n        r2d = \"r2\", \n        token = 'a6deee62cc4a', \n        append = TRUE,           # We appended the results of each LDlink query to a single file\n        genome_build = \"grch37\") # Select genome build based on summary stats\nsystem(\"mv combined_query_snp_list_grch37.txt data/exposure_outcome_proxy_snps.txt\")\n\n\n# Munge proxy snp file\noutcome_dat <- munge_proxies(\"data/exposure_outcome_proxy_snps.txt\", outcome, outcome_clump)"
  },
  {
    "objectID": "scripts/mr_harmonization.html#harmonize-exposure---outcome-datasets",
    "href": "scripts/mr_harmonization.html#harmonize-exposure---outcome-datasets",
    "title": "3  Harmonizing SumStats",
    "section": "Harmonize Exposure - Outcome Datasets",
    "text": "Harmonize Exposure - Outcome Datasets\nFinally, the effect of a SNP on an outcome and exposure must be harmonised to be relative to the same allele. We also specify to infer the positive strand alleles, using allele frequencies for palindromes rather then removing palindromic variants.\n\n\nHarmonize\nmr_dat <- harmonise_data(exposure_dat, outcome_dat, action = 2) %>% as_tibble() %>%\n#  mutate(\n#    apoe_region = case_when(\n#      chr.outcome == 19 & between(pos.outcome, 44912079, 45912079) ~ TRUE,\n#      TRUE ~ FALSE\n#    ), \n#    gws.outcome = ifelse(pval.outcome < 5e-8, TRUE, FALSE), \n#   mr_keep = ifelse(mr_keep == FALSE | apoe_region == TRUE | gws.outcome == TRUE, FALSE, TRUE)\n#  )\n  filter(pval.exposure < 5e-8)\n\n\n\n\n\n\n\n\nNote\n\n\n\nThe variable mr_keep is used to determine the SNPs to be included in the MR analysis. It is recommended to exclude variants with pval.outcome < 5e-8 as they violate the exclusion restriction assumption. For studies involving Alzheimer’s disease, variants in the APOE region (GRCh37 - CHR: 19, BP: 44912079-45912079) should also be removed due to its large effect size and pleiotropic nature. However, in this tutorial, this step is not performed to demonstrate how causal estimates can be influenced by horizontal pleiotropy.\n\n\n\n\n\nAnd now we have a final harmonized dataset that can be used in our downstream MR analyses"
  },
  {
    "objectID": "scripts/mr.html#methods",
    "href": "scripts/mr.html#methods",
    "title": "4  TwoSampleMR",
    "section": "Methods",
    "text": "Methods\n\nTools & Publications\nR, TwoSampleMR, MendelianRandomization\n\nHemani, G. et al. The MR-Base platform supports systematic causal inference across the human phenome. Elife 7, e34408 (2018).\nYavorska, O. O. & Burgess, S. MendelianRandomization: an R package for performing Mendelian randomization analyses using summarized data. Int J Epidemiol 46, dyx034 (2017).\n\nIVW: The simplest method for MR causal effect estimation is the inverse variance weighted (IVW) meta-analysis of each genetic instrument’s Wald ratio. This is similar to conducting a weighted regression of SNP-exposure effects against SNP-outcome effects, with the regression line passing through the origin. Fixed effects IVW is the most powerful method for MR analysis and is widely accepted as the primary method. However, it assumes that there is no horizontal pleiotropy and is sensitive to violations of MR assumptions. Random effects IVW relaxes this assumption by allowing each SNP to have a different mean effect, providing an unbiased estimate if horizontal pleiotropy is present in a balanced manner.\nMaximum likelihood: The causal effect is estimated by direct maximization of the liklihood given the SNP-exposure and SNP-outcome effects and assuming a linear relationship between the exposure and outcome. May provide more reliable results in the presence of measurement error in the SNP-exposure effects, but assumes that there is no heterogeneity or horizontal pleiotropy.\nMR-Egger: The Inverse Variance Weighted (IVW) method can be modified to account for horizontal pleiotropy by including a non-zero intercept. This allows for an estimation of net horizontal pleiotropic effects even if they are not balanced or directional. However, this approach assumes that the horizontal pleiotropic effects are uncorrelated with the SNP-exposure effects, known as the InSIDE assumption. Despite this, the MR-Egger method may have lower precision, leading to a reduction in statistical power to detect causal relationships.\nMode Based Estimators: Clusters SNPs into groups based on similarity of their causal effects and returns the causal estimates based on the cluster with the largest number of SNPs. Weighting each SNPs contribution to the clustering by the inverse variance of its outcome of its outcome effect can be also be used. Returns an unbiased causal estimate when all the SNPs in the largest cluster are valid instruments.\nMedian Based Estimators: Estimating the causal effect by taking the median effect of all avaliable SNPs allows for only half the SNPs needing to be valid instruments. Weighting the contribution of each SNP by the inverse variance of its association with the outcome allows for stronger SNPs to contribute more towards the estimate."
  },
  {
    "objectID": "scripts/mr.html#perform-mr-analysis",
    "href": "scripts/mr.html#perform-mr-analysis",
    "title": "4  TwoSampleMR",
    "section": "Perform MR analysis",
    "text": "Perform MR analysis\n\n\nImport Data\nmr_dat <- read_csv('data/harmonized_data.csv')\n\n\n\n\nMR analysis\nmr_res <- mr(mr_dat, method_list = c(\n  \"mr_two_sample_ml\",  \"mr_egger_regression\", \"mr_egger_regression_bootstrap\",\n  \"mr_simple_median\", \"mr_weighted_median\", \"mr_penalised_weighted_median\", \n  \"mr_ivw_fe\", \"mr_ivw_mre\",\n  \"mr_simple_mode\", \"mr_weighted_mode\", \"mr_weighted_mode_nome\", \"mr_simple_mode_nome\"\n  ))\n\n\nMR analysis\nres_single <- mr_singlesnp(mr_dat, all_method = c(\"mr_ivw_fe\", \"mr_egger_regression\", \"mr_weighted_median\", \"mr_weighted_mode\")) %>% as_tibble()\n\n\nIn the fixed effects IVW analysis, higher genetically predicted total cholesteroal levels are associated with increased risk of Alzheimer’s disease. However, the majority of our pleiotropy robust methods are non-significant, suggesting that the causal effects may be biased.\n\n\n\n\n\n\n  \n  \n    \n      method\n      nsnp\n      b\n      se\n      pval\n    \n  \n  \n    Maximum likelihood\n84\n0.33\n0.04\n9.6 × 10−20\n    MR Egger\n84\n0.67\n0.19\n7.1 × 10−4\n    MR Egger (bootstrap)\n84\n−0.03\n0.07\n0.346\n    Simple median\n84\n0.01\n0.07\n0.913\n    Weighted median\n84\n0.05\n0.06\n0.428\n    Penalised weighted median\n84\n−0.03\n0.06\n0.690\n    Inverse variance weighted (fixed effects)\n84\n0.31\n0.03\n1.7 × 10−19\n    Inverse variance weighted (multiplicative random effects)\n84\n0.31\n0.12\n0.007\n    Simple mode\n84\n−0.05\n0.11\n0.665\n    Weighted mode\n84\n−0.05\n0.07\n0.497\n    Weighted mode (NOME)\n84\n−0.05\n0.07\n0.476\n    Simple mode (NOME)\n84\n−0.05\n0.13\n0.695\n  \n  \n  \n\n\n\n\nThe relationship between SNP effects on the exposure and SNP effects on the outcome can be visualized through a scatter plot. The slopes of the lines correspond to the estimated causal effect for each method.\n\n\nMR Scatter Plot\nscatter_p <- mr_scatter_plot(mr_res, mr_dat) \n\n\nMR Scatter Plot\nscatter_out_p <- scatter_p[[1]] + theme_bw() + \n  guides(color=guide_legend(ncol =1)) + \n  theme(\n    text = element_text(size = 8), \n  )\n\nscatter_out_p\n\n\n\n\n\nForest plots can be used to display the Wald ratio for single SNPs and their combined effects.\n\n\nMR Forrest Plot\nforrest_p <- mr_forest_plot(res_single)\nforrest_p[[1]]"
  },
  {
    "objectID": "scripts/mr.html#diagnostics",
    "href": "scripts/mr.html#diagnostics",
    "title": "4  TwoSampleMR",
    "section": "Diagnostics",
    "text": "Diagnostics\nDiagnostics and sensetivity analyses are used to evaluate if the causal estimates are robust to violations of MR underlying assumptions.\n\nPleiotropy\nThe intercept term in MR-Egger regression can provide an indication of the presence of directional horizontal pleiotropy, and help to determine the robustness of the MR results. Directional horizontal pleiotropy refers to the situation where a genetic variant used as an instrumental variable in a Mendelian randomization (MR) study influences the exposure and outcome in the same direction. This can result in biased estimates of the causal effect of the exposure on the outcome, and compromise the validity of the MR results.\nWe observe that the MR-Egger regression intercept for Total cholesterol onto AD is significant, suggesting that the IVW causal estimate is biased by directional horizontal pleiotropy.\n\n\nPleiotropy\nres_pleio <- mr_pleiotropy_test(mr_dat)\n\nres_pleio %>%\n  select(-id.exposure, -id.outcome, -outcome, -exposure) %>%\n  gt() %>%\n  fmt_number(\n    columns = c('egger_intercept', 'se')\n  ) %>%\n  fmt_number(\n    columns = pval,\n    rows = pval > 0.001,\n    decimals = 3\n  ) %>% \n  fmt_scientific(\n    columns = pval,\n    rows = pval <= 0.001,\n    decimals = 1\n  )\n\n\n\n\n\n\n  \n  \n    \n      egger_intercept\n      se\n      pval\n    \n  \n  \n    −0.02\n0.01\n0.023\n  \n  \n  \n\n\n\n\n\n\nHeterogeneity\nHeterogeneity refers to the variability or diversity in the relationship between an exposure variable and an outcome variable across different genetic variants that are used as instrumental variables. Heterogeneity can arise due to several factors, including differences in the strength of the genetic associations with the exposure and outcome, differences in the direction of effect, or differences in the way that the genetic variants interact with other variables that may confound the relationship. Heterogeneity can pose a challenge for the validity of the MR results, as it may indicate that the assumption of a consistent relationship between the exposure and outcome across different SNPs is not met. If heterogeneity is present, it can indicate that the underlying causal relationship between the exposure and outcome is complex and cannot be captured by a single SNP or set of SNPs.\nWe can estimate heterogeneity using Cochran’s Q Test. We observe that there is significant heterogeneity in the IVW and MR-Egger analysis, further highlighting that the IVW causal estimates are likely biased.\n\n\nHeterogeneity\n# Heterogeneity statistics \nres_het <- mr_heterogeneity(mr_dat, method_list = c(\"mr_egger_regression\", \"mr_ivw\"))\n\nres_het %>%\n  select(-id.exposure, -id.outcome, -outcome, -exposure) %>%\n  gt() %>%\n  fmt_number(\n    columns = Q\n  ) %>%\n  fmt_number(\n    columns = Q_pval,\n    rows = Q_pval > 0.001,\n    decimals = 3\n  ) %>% \n  fmt_scientific(\n    columns = Q_pval,\n    rows = Q_pval <= 0.001,\n    decimals = 1\n  )\n\n\n\n\n\n\n  \n  \n    \n      method\n      Q\n      Q_df\n      Q_pval\n    \n  \n  \n    MR Egger\n862.04\n82\n2.1 × 10−130\n    Inverse variance weighted\n918.33\n83\n5.2 × 10−141\n  \n  \n  \n\n\n\n\nFunnel plots in which the estimate for each SNP is plotted against its precision can be used to visually inspect for horizontal pleitropy, with asymmetry indicative of invalid instruments.\n\n\nFunnel plots\nfunnel_p <- mr_funnel_plot(res_single)\nfunnel_out_p <- funnel_p[[1]] + theme_bw() + \n  guides(color=guide_legend(ncol =1)) + \n  theme(\n    text = element_text(size = 8), \n  )\n\nfunnel_out_p\n\n\n\n\n\n\n\nOutliers\nLeave-one-out analysis can be used to determine if a MR causal estimate is driven or biased by a single SNP that might have a particularly large horizontal pleiotropic effect. The MR causal effect is re-estimated by sequentially droping one SNP at a time.\nWe observe dramatic changes in the MR causal estimates when two SNPs - rs7412 and rs75687619 - are droped from the analysis. This suggests that the IVW estimate is particularly sensitive to the inclusion of these variants and that they are potentially outliers.\n\n\nLeave-one-out\n# Leave-one-out analysis \nres_loo <- mr_leaveoneout(mr_dat, method = mr_ivw_fe) %>% as_tibble()\n\nloo_p <- mr_leaveoneout_plot(res_loo)\nloo_p[[1]]"
  },
  {
    "objectID": "scripts/mr.html#summary",
    "href": "scripts/mr.html#summary",
    "title": "4  TwoSampleMR",
    "section": "Summary",
    "text": "Summary\nIn the IVW analysis we observed that higher genetically predicted total cholesterol levels were causaly associated with an increased risk of Alzheimer’s disease. However, the majority of our sensitivity analysis are non-significant suggesting that our IVW estimated is biased. Furthermore, while the MR-Egger causal estimate is significant, this is likely due to violations of the InSIDE assumption. The robustness of our causal estimate is further called into question by the presense of significant heterogeneity, horizontal pleitropy, and outliers."
  },
  {
    "objectID": "scripts/radial_mr.html#methods",
    "href": "scripts/radial_mr.html#methods",
    "title": "5  Radial-MR",
    "section": "Methods",
    "text": "Methods\n\nTools & Publications\nR, RadialMR\n\nBowden, J., et al., Improving the visualization, interpretation and analysis of two-sample summary data Mendelian randomization via the Radial plot and Radial regression. International Journal of Epidemiology, 2018. 47(4): p. 1264-1278.\n\nRadial MR: Produces radial plots and performs radial regression for inverse variance weighted and MR-Egger regression models. These plots have the advantage of improving the visual detection of outliers, as well as being coding invariant. The contribution of each individule SNP to the Cochran’s Q statistic is quantified, with SNPs that have a large contribution been classified as outliers based on significance level selected by the user - typically a bonferonni correction. Outliers can be removed for downstream analysis."
  },
  {
    "objectID": "scripts/radial_mr.html#perform-radial-mr",
    "href": "scripts/radial_mr.html#perform-radial-mr",
    "title": "5  Radial-MR",
    "section": "Perform Radial MR",
    "text": "Perform Radial MR\n\n\n\nThe RadialMR package requires a different input data format to that of TwoSampleMR, so we first use TwoSampleMR::dat_to_RadialMR() to convert our TwoSampleMR harmonized data to the formate required by RadialMR.\n\n\nRadial MR\n# Format data \nradial_dat <- mr_dat %>% filter(mr_keep == T) %>% dat_to_RadialMR()\nrmr_dat <- radial_dat$TC.AD\n\n# Run Radial MR\nbonff = 0.05/nrow(rmr_dat) # Bonferonni Correction\nradial_ivw_res <- ivw_radial(rmr_dat, alpha = bonff) \n\n\n\nRadial IVW\n\n                  Estimate  Std.Error   t value     Pr(>|t|)\nEffect (Mod.2nd) 0.3140916 0.11586058  2.710944 6.709190e-03\nIterative        0.3140955 0.11586121  2.710964 6.708800e-03\nExact (FE)       0.3524370 0.03503782 10.058760 8.405058e-24\nExact (RE)       0.3179997 0.20121187  1.580422 1.178138e-01\n\n\nResidual standard error: 3.31 on 83 degrees of freedom\n\nF-statistic: 7.35 on 1 and 83 DF, p-value: 0.00815\nQ-Statistic for heterogeneity: 909.3152 on 83 DF , p-value: 3.196198e-139\n\n Outliers detected \nNumber of iterations = 3\n\n\nRadial MR\nradial_egger_res <- egger_radial(rmr_dat, alpha = bonff) \n\n\n\nRadial MR-Egger\n\n              Estimate Std. Error   t value    Pr(>|t|)\n(Intercept) -0.9612088  0.6654372 -1.444477 0.152415150\nWj           0.5755524  0.2154432  2.671482 0.009106335\n\nResidual standard error: 3.25 on 82 degrees of freedom\n\nF-statistic: 7.14 on 1 and 82 DF, p-value: 0.00911\nQ-Statistic for heterogeneity: 866.2584 on 82 DF , p-value: 1.007391e-130\n\n Outliers detected \n\n\nAs with our core MR methods, we observed that the Radial-MR causal estimates indicated that total cholesteroal is causaly associated with an increased risk of AD, however, there is significant heterogenity.\n\n\n\n\n\n\n  \n  \n    \n      \n      b\n      se\n      statistic\n      p\n    \n  \n  \n    \n      IVW\n    \n    Effect (Mod.2nd)\n0.31\n0.12\n2.71\n0.007\n    Iterative\n0.31\n0.12\n2.71\n0.007\n    Exact (FE)\n0.35\n0.04\n10.06\n8.4 × 10−24\n    Exact (RE)\n0.32\n0.20\n1.58\n0.118\n    Q-Statistic\nNA\nNA\n909.32\n3.2 × 10−139\n    \n      Egger\n    \n    (Intercept)\n−0.96\n0.67\n−1.44\n0.152\n    Wj\n0.58\n0.22\n2.67\n0.009\n    Q-Statistic\nNA\nNA\n866.26\n1.0 × 10−130\n  \n  \n  \n\n\n\n\nExamining the Radial Plots we also further observe a number of variants were classifed as outliers, which are determined with respect to their contribution to global heterogeneity as quantified by Cochran’s Q-statistic and using a a bonferonni corrected significance threshold.\n\n\nRadial Plots\nivw_radial_p <- plot_radial(radial_ivw_res, radial_scale = F, show_outliers = F)\negger_radial_p <- plot_radial(radial_egger_res, radial_scale = F, show_outliers = F)\n\ncowplot::plot_grid(\n  ivw_radial_p + coord_fixed(ratio=0.25) + theme(legend.position = 'bottom'), \n   egger_radial_p + theme(legend.position = 'bottom'), \n  align = 'h'\n)\n\n\n\n\n\nThe IVW Radial MR method identified six variants as potential outliers. We can query PhenoScanner to obtain further information on these SNPs (and variants they are in LD with) including what other traits they have been associated with.\n\n\nRemove outliers\n# Phenoscanner \nphewas_dat <- phenoscanner(\n  snpquery=radial_ivw_res$outliers$SNP, \n  proxies='EUR', \n  r2 = 0.8\n  ) \n\n\nPhenoScanner V2\nCardiovascular Epidemiology Unit\nUniversity of Cambridge\nEmail: phenoscanner@gmail.com\n\nInformation: Each user can query a maximum of 10,000 SNPs (in batches of 100), 1,000 genes (in batches of 10) or 1,000 regions (in batches of 10) per hour. For large batch queries, please ask to download the data from www.phenoscanner.medschl.cam.ac.uk/data.\nTerms of use: Please refer to the terms of use when using PhenoScanner V2 (www.phenoscanner.medschl.cam.ac.uk/about). If you use the results from PhenoScanner in a publication or presentation, please cite all of the relevant references of the data used and the PhenoScanner publications: www.phenoscanner.medschl.cam.ac.uk/about/#citation.\n\n[1] \"1 -- chunk of 10 SNPs queried\"\n\n\nRemove outliers\nradial_ivw_res$outliers %>% \n  left_join(filter(phewas_dat$snps, snp == rsid), by = c(\"SNP\" = \"snp\")) %>%\n  select(SNP, Q_statistic, p.value, hg19_coordinates, a1, a2, hgnc) %>% \n  DT::datatable()\n\n\n\n\n\n\n\nExamining the PheWAS results, we can see that three of the outliers (rs7412, rs7568769, and rs8103315) are all located within the APOE region and associated with Alzheimer’s disease. These are the same variants that were previously observed to be driving the IVW causal estimates from the Leave-one-out anlaysis.\n\n\n\n\n\n\n\nNow that have identified outliers, we can re-run our core MR methods with outliers removed. We join the radial MR results to our harmonized dataset and modify the mr_keep variable to flag outliers for removal.\n\n\nRemove outliers\n## Modify the mrkeep variable to flag variants as outliers from radial MR for removal\nmr_dat_outlier <- mr_dat %>%\n  left_join(radial_ivw_res$dat) %>%\n  mutate(\n     mr_keep = case_when(\n       Outliers == \"Outlier\" ~ FALSE, \n       TRUE ~ mr_keep\n     )\n  )\n\n\nAfter removing outliers, the IVW estimates are no longer significant.\n\n\nMR analysis w/o outliers\n# Standard MR\nmr_res <- mr(mr_dat, method_list = c(\n  c(\"mr_ivw_fe\", \"mr_egger_regression\", \"mr_weighted_median\", \"mr_weighted_mode\")\n  ))\n\n## MR analysis \nmr_res_outlier <- mr(mr_dat_outlier, method_list = c(\"mr_ivw_fe\", \"mr_egger_regression\", \"mr_weighted_median\", \"mr_weighted_mode\"))\n\n# Heterogeneity statistics \nmr_het_outlier <- mr_heterogeneity(mr_dat_outlier, method_list = c(\"mr_egger_regression\", \"mr_ivw\"))\n\n# Horizontal pleitropy\nmr_plt_outlier <- mr_pleiotropy_test(mr_dat_outlier)\n\n# Radial MR \nradial_dat_outlier <- mr_dat_outlier %>% filter(mr_keep == T) %>% dat_to_RadialMR()\nradial_res_outlier <- ivw_radial(radial_dat_outlier$TC.AD, alpha = 0.05/nrow(radial_dat_outlier$TC.AD)) \n\n\n\nRadial IVW\n\n                     Estimate  Std.Error    t value  Pr(>|t|)\nEffect (Mod.2nd) -0.007293342 0.05138246 -0.1419423 0.8871256\nIterative        -0.007293342 0.05138246 -0.1419423 0.8871256\nExact (FE)       -0.007407696 0.04038259 -0.1834379 0.8544545\nExact (RE)       -0.007357159 0.04696621 -0.1566479 0.8759323\n\n\nResidual standard error: 1.272 on 77 degrees of freedom\n\nF-statistic: 0.02 on 1 and 77 DF, p-value: 0.887\nQ-Statistic for heterogeneity: 124.6615 on 77 DF , p-value: 0.0004808313\n\n Outliers detected \nNumber of iterations = 2\n\n\nMR analysis w/o outliers\nbind_rows(\n  mr_res %>% mutate(model = \"w/ Outliers\"), \n  mr_res_outlier %>% mutate(model = \"w/o Outliers\")) %>%\n  select(model, method, nsnp, b, se, pval) %>%\n  gt(\n    groupname_col = \"model\"\n  ) %>%\n  fmt_number(\n    columns = c(\"b\", \"se\")\n  ) %>%\n  fmt_number(\n    columns = pval,\n    rows = pval > 0.001,\n    decimals = 3\n  ) %>% \n  fmt_scientific(\n    columns = pval,\n    rows = pval <= 0.001,\n    decimals = 1\n  ) \n\n\n\n\n\n\n  \n  \n    \n      method\n      nsnp\n      b\n      se\n      pval\n    \n  \n  \n    \n      w/ Outliers\n    \n    Inverse variance weighted (fixed effects)\n84\n0.31\n0.03\n1.7 × 10−19\n    MR Egger\n84\n0.67\n0.19\n7.1 × 10−4\n    Weighted median\n84\n0.05\n0.07\n0.452\n    Weighted mode\n84\n−0.05\n0.07\n0.498\n    \n      w/o Outliers\n    \n    Inverse variance weighted (fixed effects)\n78\n−0.01\n0.04\n0.857\n    MR Egger\n78\n−0.15\n0.10\n0.131\n    Weighted median\n78\n−0.02\n0.06\n0.775\n    Weighted mode\n78\n−0.03\n0.08\n0.668\n  \n  \n  \n\n\n\n\nThis is even more apparant when inspect the scatter and radial plots before and after outlier removal.\n\n\nMR plots w/o outliers\n# Plots\nscatter_p <- mr_scatter_plot(mr_res, mr_dat) \nscatter_out_p <- scatter_p[[1]] + theme_bw() + \n  guides(color=guide_legend(nrow =1)) + \n  labs(title = \"w/ outliers\") +\n  theme(\n    text = element_text(size = 8), \n    legend.position = 'bottom'\n  )\n\nscatter_outlier_p <- mr_scatter_plot(mr_res_outlier, mr_dat_outlier)\n\nscatter_outlier_out_p <- scatter_outlier_p[[1]] + theme_bw() + \n  guides(color=guide_legend(nrow =1)) + \n  labs(title = \"w/o outliers\") +\n  theme(\n    text = element_text(size = 8), \n    legend.position = 'bottom'\n  )\n\nradial_outlier_p <- plot_radial(radial_res_outlier, radial_scale = F, show_outliers = F)\n\ncowplot::plot_grid(\n  scatter_out_p + theme(legend.position = 'none'), \n  scatter_outlier_out_p + theme(legend.position = 'none'), \n  ivw_radial_p + coord_fixed(ratio=0.25) + theme(legend.position = 'none') + labs(title = \"w/ outliers\"),\n  radial_outlier_p + coord_fixed(ratio=0.2) + theme(legend.position = 'none') + labs(title = \"w/o outliers\") \n)"
  },
  {
    "objectID": "scripts/radial_mr.html#the-apoe-region",
    "href": "scripts/radial_mr.html#the-apoe-region",
    "title": "5  Radial-MR",
    "section": "The APOE region",
    "text": "The APOE region\nIn the initial analysis, six SNPs were identified as potential outliers by Radial-MR. Three of these SNPs were located in the APOE region, known for its large effect size and pleiotropic nature, and were clear outliers based on their Q-statistics. In contrast the other three variants were located elsewhere on the genome and had significanlty smaller Q-statistics. It is possible that the large contribution of the individules APOE variants to the global heterogenity statistcs could be biasing the Q-statistics of other variants.\n\n\nRadial MR w/o APOE\nmr_dat_wo_apoe <- mr_dat %>%\n mutate(\n   apoe_region = case_when(\n     chr.outcome == 19 & between(pos.outcome, 44912079, 45912079) ~ TRUE,\n     TRUE ~ FALSE\n   ),\n   gws.outcome = ifelse(pval.outcome < 5e-8, TRUE, FALSE),\n   mr_keep = case_when(\n       apoe_region == TRUE ~ FALSE, \n       gws.outcome == TRUE ~ FALSE, \n       TRUE ~ mr_keep\n     )\n )\n\n# Radial MR \nradial_dat_wo_apoe <- mr_dat_wo_apoe %>% filter(mr_keep == T) %>% dat_to_RadialMR()\nradial_res_wo_apoe <- ivw_radial(radial_dat_wo_apoe$TC.AD, alpha = 0.05/nrow(radial_dat_wo_apoe$TC.AD)) \n\n\n\nRadial IVW\n\n                    Estimate  Std.Error    t value  Pr(>|t|)\nEffect (Mod.2nd) -0.04916017 0.05347782 -0.9192629 0.3579581\nIterative        -0.04916017 0.05347782 -0.9192629 0.3579581\nExact (FE)       -0.04997953 0.03907883 -1.2789412 0.2009178\nExact (RE)       -0.04961546 0.04868966 -1.0190143 0.3112680\n\n\nResidual standard error: 1.368 on 80 degrees of freedom\n\nF-statistic: 0.85 on 1 and 80 DF, p-value: 0.361\nQ-Statistic for heterogeneity: 149.8155 on 80 DF , p-value: 3.737286e-06\n\n Outliers detected \nNumber of iterations = 2\n\n\nRadial MR w/o APOE\nradial_wo_apoe_p <- plot_radial(radial_res_wo_apoe, radial_scale = F, show_outliers = F)\n\n\nWhen the APOE region was removed before conducting radial MR, only two SNPs were now flagged as outliers. These were rs6504872, which was still considered an outlier after removing the APOE region, and a new variant, rs9391858, which emerged as an outlier after this step. This suggests that including the APOE region can bias the Q-statistics of other variants.\n\n\nRadial MR Plots w/o APOE\ncowplot::plot_grid(\n  ivw_radial_p + coord_fixed(ratio=0.25) + theme(legend.position = 'none') + labs(title = \"w/ APOE\"),\n  radial_wo_apoe_p + coord_fixed(ratio=0.2) + theme(legend.position = 'none') + labs(title = \"w/o APOE\"), \n  align = 'h'\n)"
  },
  {
    "objectID": "scripts/radial_mr.html#summary",
    "href": "scripts/radial_mr.html#summary",
    "title": "5  Radial-MR",
    "section": "Summary",
    "text": "Summary\nRadial-MR provides an improved visual interpretion of MR analyses and displayes data points with large contributions to Cochran’s Q statistic that are likely to be outliers. Based on this statistical criterion, indivdual variants can be removed from downstream MR analyses to obtain more robust causal estitmates. However, care should be taken when adopting a strategy of removing all outliers until little or no heterogeneity remains. This is highlighted when considering the APOE region, which caused additional variants to be classifed as outliers despite haveing moderate Q-statistics. Exclusion of a particular SNPs should additionaly be based on whether the SNP is associated with separate phenotypes that represent a pleiotropic pathways to the outcome."
  }
]